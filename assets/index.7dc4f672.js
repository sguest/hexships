var ve=Object.defineProperty,we=Object.defineProperties;var ze=Object.getOwnPropertyDescriptors;var he=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var te=(t,e,i)=>e in t?ve(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,P=(t,e)=>{for(var i in e||(e={}))Me.call(e,i)&&te(t,i,e[i]);if(he)for(var i of he(e))Ce.call(e,i)&&te(t,i,e[i]);return t},I=(t,e)=>we(t,ze(e));var C=(t,e,i)=>(te(t,typeof e!="symbol"?e+"":e,i),i);import{c as M,j as p,R as me,a as g,r as m,F as G,l as Te,b as Pe,d as He}from"./vendor.dc3d6da2.js";const Ne=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}};Ne();var oe=(t=>(t[t.positiveX=0]="positiveX",t[t.positiveY=1]="positiveY",t[t.positiveZ=2]="positiveZ",t[t.negativeX=3]="negativeX",t[t.negativeY=4]="negativeY",t[t.negativeZ=5]="negativeZ",t))(oe||{});const Oe={[0]:{x:1,y:0},[1]:{x:0,y:1},[2]:{x:-1,y:1},[3]:{x:-1,y:0},[4]:{x:0,y:-1},[5]:{x:1,y:-1}};function E(t){return Oe[t]}function fe(){return[0,1,2,3,4,5]}function k(...t){const e={x:0,y:0};for(const i of t)e.x+=i.x,e.y+=i.y;return e}function T(t,e){return{x:t.x*e,y:t.y*e}}function b(t,e){return t.x===e.x&&t.y===e.y}function q(t,e){t.moveTo(e.x,e.y)}function X(t,e){t.lineTo(e.x,e.y)}const re=Math.sqrt(3),N=20;function j(t){return{x:1.5*t.x*N,y:(t.y+.5*t.x)*N*re}}function Se(t){const e=j(t);return[...Array(6).keys()].map(i=>{const n=Math.PI/3*i;return{x:e.x+N*Math.cos(n),y:e.y+N*Math.sin(n)}})}function Ie(t){return{x:t*3*N,y:t*2*N*re}}function Re(t){const e=-t.x-t.y;let i=Math.round(t.x),n=Math.round(t.y);const o=Math.round(e),s=Math.abs(i-t.x),r=Math.abs(n-t.y),l=Math.abs(o-e);return s>r&&s>l?i=-n-o:r>l&&(n=-i-o),{x:i,y:n}}function Be(t){return Re({x:t.x*2/3/N,y:(t.x*-1/3+t.y*re/3)/N})}function z(t,e){const i=-t.x-t.y;return t.x>-e&&t.x<e&&t.y>-e&&t.y<e&&i>-e&&i<e}function Ee(t){const e=[];for(let i=-t+1;i<t;i++)for(let n=-t+1;n<t;n++)z({x:i,y:n},t)&&e.push({x:i,y:n});return e}function Fe(t,e){return fe().map(i=>{const n=E(i);return k(t,n)}).filter(i=>z(i,e))}function A(t){const e=E(t.facing);let i={x:t.x,y:t.y};const n=[{x:t.x,y:t.y}];for(let o=1;o<t.size;o++)i=k(i,e),n.push(i);return n}function ye(t,e,i){const n=A(t),o=e.map(s=>A(s)).flat();for(const s of n){if(!z(s,i))return!1;for(const r of o)if(b(s,r))return!1}return!0}function ae(t,e){for(let i=0;i<t.length;i++)if(!ye(t[i],t.slice(i+1),e))return!1;return!0}var H=(t=>(t[t.Hit=0]="Hit",t[t.Miss=1]="Miss",t))(H||{});function pe(t){return t.filter(e=>e.hits===e.size)}function le(t,e){return t.shotPerShip?e.ownShips.length-pe(e.ownShips).length:t.shots}class Le{constructor(e,i){C(this,"players");C(this,"activePlayerId");this.gameSettings=e,this.subscriber=i,this.players=[{ships:[],mines:[],markers:[],active:!0},{ships:[],mines:[],markers:[],active:!0}],this.activePlayerId=0}getLocalState(e){const i=+!e,n=this.playerLost(i),o=this.playerLost(e),s=o||n;return{ownShips:this.players[e].ships,ownMarkers:this.players[e].markers,ownMines:this.players[e].mines,opponentShips:s?this.players[i].ships:void 0,opponentMarkers:this.players[i].markers,opponentMines:this.players[i].mines.filter(r=>s||this.players[e].markers.some(l=>b(r,l))),isOwnTurn:e===this.activePlayerId&&!!this.players[e].ships.length,sunkEnemies:pe(this.players[i].ships).map(r=>r.definitionId),gameWon:n,gameLost:o,opponentShipsPlaced:!!this.players[i].ships.length,opponentLeft:!this.players[i].active}}playerLost(e){const i=this.players[e];return!i.active||!!i.ships.length&&i.ships.every(n=>n.hits===n.size)}validateShipPlacement(e){const i=this.gameSettings.ships.slice(0),n=[];for(const o of e){const s=i.findIndex(l=>l.id===o.definitionId);if(s===-1)return[];const r=i[s];n.push({x:o.x,y:o.y,size:r.size,facing:o.facing,hits:0,name:r.name,definitionId:o.definitionId}),i.splice(s,1)}return i.length?[]:ae(n,this.gameSettings.gridSize)?n:[]}validateMinePlacement(e,i){if(e.length!==this.gameSettings.mines)return!1;const n=i.map(o=>A(o)).flat();for(const o of e)if(n.some(s=>b(s,o))||e.some(s=>s!==o&&b(o,s))||!z(o,this.gameSettings.gridSize))return!1;return!0}setFleet(e,i){if(!this.players[e])return;const n=this.validateShipPlacement(i.ships);n.length&&this.validateMinePlacement(i.mines,n)?(this.players[e].ships=n,this.players[e].mines=i.mines.slice(),this.allShipsPlaced()?this.broadcastState():this.sendState(e)):this.sendState(e)}tryHit(e,i){for(const n of e)for(const o of A(n))if(b(o,i))return n.hits++,!0;return!1}fireShots(e,i){const n=this.players[e],o=this.getLocalState(e),s=+!e;if(this.activePlayerId===e&&!this.playerLost(e)&&!this.playerLost(s)&&this.allShipsPlaced()&&i.length===le(this.gameSettings,o)&&i.every(l=>!!l&&z(l,this.gameSettings.gridSize)&&!n.markers.some(c=>b(c,l))&&!i.some(c=>c!==l&&b(l,c)))){let l=!1;for(const c of i){const a=this.tryHit(this.players[s].ships,c);if(n.markers.push({x:c.x,y:c.y,type:a?H.Hit:H.Miss}),l=l||a,this.players[s].mines.some(d=>b(d,c)))for(const d of[...Fe(c,this.gameSettings.gridSize),c])this.players[s].markers.some(u=>b(u,d))||this.players[s].markers.push({x:d.x,y:d.y,type:this.tryHit(this.players[e].ships,d)?H.Hit:H.Miss})}(!this.gameSettings.streak||!l)&&(this.activePlayerId=s),this.broadcastState()}else this.sendState(e)}leaveGame(e){const i=+!e;!this.playerLost(e)&&!this.playerLost(i)&&(this.players[e].active=!1,this.broadcastState())}sendState(e){this.subscriber(e,this.getLocalState(e))}broadcastState(){for(let e=0;e<this.players.length;e++)this.sendState(e)}allShipsPlaced(){return this.players.every(e=>e.ships.length)}}function $(t,e){return Math.floor(Math.random()*(e-t+1))+t}function De(t){const e=Object.keys(t).map(o=>Number.parseInt(o)).filter(o=>!Number.isNaN(o)),i=Math.floor(Math.random()*e.length);return e[i]}class $e{constructor(e){C(this,"ownShots",[]);C(this,"ownShotCount",0);C(this,"priorityHits",[]);C(this,"trackedHits",[]);C(this,"sunkShips",[]);this.gameSettings=e}generateFleet(){const e=[],i=-this.gameSettings.gridSize,n=-this.gameSettings.gridSize,o=this.gameSettings.gridSize,s=this.gameSettings.gridSize;for(const c of this.gameSettings.ships){let a;do a={size:c.size,name:c.name,x:$(i,o),y:$(n,s),facing:De(oe),hits:0,definitionId:c.id};while(!ae([...e,a],this.gameSettings.gridSize));e.push(a)}const r=[],l=e.map(A).flat();for(let c=0;c<this.gameSettings.mines;c++){let a;do a={x:$(i,o),y:$(n,s)};while(!z(a,this.gameSettings.gridSize)||r.some(d=>b(d,a)||l.some(u=>b(u,a))));r.push(a)}return{ships:e,mines:r}}updateState(e){var i,n;if(!!((i=e.ownMarkers)==null?void 0:i.length))for(;e.ownMarkers.length>this.ownShotCount;){const o=e.ownMarkers[this.ownShotCount];if(this.ownShots[o.x]=this.ownShots[o.x]||[],this.ownShots[o.x][o.y]===void 0&&(this.ownShots[o.x][o.y]=o.type,o.type===H.Hit)){if(e.sunkEnemies.length===this.sunkShips.length)this.priorityHits.push(o),this.trackedHits.push(o);else for(const s of e.sunkEnemies)if(this.sunkShips.indexOf(s)===-1){this.sunkShips.push(s);const r=(n=this.gameSettings.ships.find(l=>l.id===s))==null?void 0:n.size;if(r){let l=!1;for(let c=0;c<6;c++)if(!l){const a=E(c);let d=o;const u=[d];for(let h=0;h<r;h++)d=k(d,a),this.trackedHits.find(x=>b(x,d))&&u.push(d);if(u.length===r){l=!0;for(const h of u){let f=this.trackedHits.findIndex(x=>b(x,h));f!==-1&&this.trackedHits.splice(f,1),f=this.priorityHits.findIndex(x=>b(x,h)),f!==-1&&this.priorityHits.splice(f,1)}}}}}}this.ownShotCount++}}getShots(e){const i=[];for(;this.priorityHits.length;){const r=this.priorityHits[0],l=fe();for(;l.length;){const a=l.splice($(0,l.length-1),1)[0];let d=E(a);const u=k(r,d);let h=r;if(this.trackedHits.find(f=>b(f,u))){for(;this.getOwnShot(h)===H.Hit&&z(h,this.gameSettings.gridSize);)h=k(h,d);for(;this.getOwnShot(h)===void 0&&z(h,this.gameSettings.gridSize);)i.push(h),h=k(h,d);for(h=r,d=E((a+3)%6);this.getOwnShot(h)===H.Hit&&z(h,this.gameSettings.gridSize);)h=k(h,d);for(;this.getOwnShot(h)===void 0&&z(h,this.gameSettings.gridSize);)i.push(h),h=k(h,d)}}if(i.length>=e)return i.slice(0,e);const c=[];for(let a=0;a<6;a++){const d=E(a),u=k(r,d);this.getOwnShot(u)===void 0&&z(u,this.gameSettings.gridSize)&&c.push(u)}for(;c.length;)i.push(c.splice($(0,c.length-1),1)[0]);if(i.length>=e)return i.slice(0,e);this.priorityHits.splice(0,1)}const n=this.gameSettings.ships.filter(r=>!this.sunkShips.some(l=>r.id===l)),o=Math.min(...n.map(r=>r.size)),s=[];for(let r=-this.gameSettings.gridSize;r<=this.gameSettings.gridSize;r++)for(let l=-this.gameSettings.gridSize;l<=this.gameSettings.gridSize;l++){const c={x:r,y:l};if(z(c,this.gameSettings.gridSize)&&this.getOwnShot(c)===void 0)for(let a=0;a<3;a++){const d=E(a);let u=!0;const h=[c];let f=c;for(let x=1;x<o;x++){f=k(f,d);const R=this.getOwnShot(f);!z(f,this.gameSettings.gridSize)||R===H.Miss?u=!1:R===void 0&&h.push(f)}u&&s.push(...h)}}for(;i.length<e;)i.push(s.splice($(0,s.length-1),1)[0]);return i}getOwnShot(e){return this.ownShots[e.x]&&this.ownShots[e.x][e.y]}}const ie=0,de=1;class Ge{constructor(e){C(this,"stateSubscriptions");C(this,"gameManager");C(this,"aiPlayer");this.gameSettings=e,this.stateSubscriptions=[],this.gameManager=new Le(e,(i,n)=>this.sendState(i,n)),this.aiPlayer=new $e(e)}onStateChange(e){this.stateSubscriptions.push(e)}offStateChange(e){const i=this.stateSubscriptions.indexOf(e);i>=0&&this.stateSubscriptions.splice(i,1)}setFleet(e){this.gameManager.setFleet(ie,e),this.gameManager.setFleet(de,this.aiPlayer.generateFleet())}fireShots(e){this.gameManager.fireShots(ie,e)}leaveGame(){}getSettings(){return this.gameSettings}sendState(e,i){e===ie?this.stateSubscriptions.forEach(n=>n(i)):(this.aiPlayer.updateState(i),i.isOwnTurn&&!i.gameLost&&!i.gameWon&&setTimeout(()=>{this.takeEnemyShot(i)},1e3))}takeEnemyShot(e){this.gameManager.fireShots(de,this.aiPlayer.getShots(le(this.gameSettings,e)))}}class Ae{constructor(e,i){C(this,"stateSubscriptions");this.socket=e,this.gameSettings=i,this.stateSubscriptions=[],this.socket.on("update-state",n=>{this.stateSubscriptions.forEach(o=>o(n))})}onStateChange(e){this.stateSubscriptions.push(e)}offStateChange(e){const i=this.stateSubscriptions.indexOf(e);i>=0&&this.stateSubscriptions.splice(i,1)}setFleet(e){this.socket.emit("set-fleet",e)}fireShots(e){this.socket.emit("fire-shots",e)}leaveGame(){this.socket.emit("leave-game")}getSettings(){return this.gameSettings}}const ue={fontSize:"1.6rem",border:"2px solid black",padding:{top:4,bottom:4,left:10,right:10},cursor:"pointer"},Ve=M({buttonContainer:{display:"flex",justifyContent:"space-between"},okButton:I(P({},ue),{"&:hover":{backgroundColor:"white"}}),cancelButton:I(P({},ue),{color:"#ccc",backgroundColor:"#333","&:hover":{backgroundColor:"#555"}})}),je={content:{border:"3px solid #ccc",display:"inline-block",background:"#333",color:"white",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:20,fontSize:"1.5rem",fontFamily:"sans-serif",inset:"50% auto auto 50%"},overlay:{zIndex:999}};function xe(t){const e=Ve(),i=()=>{t.onClose(),t.onOk&&t.onOk()};return p(me,{isOpen:!0,onRequestClose:t.onClose,style:je,children:[g("p",{children:t.text}),p("div",{className:e.buttonContainer,children:[t.okButton&&g("button",{className:e.okButton,onClick:i,children:"OK"}),t.cancelButton&&g("button",{className:e.cancelButton,onClick:t.onClose,children:"Cancel"})]})]})}const We=M({menu:{margin:0,padding:{left:20},listStyleType:"none"},menuButton:{background:"transparent",border:"none",fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"1.5rem",cursor:"pointer","&:hover":{color:"#fff"}},tooltip:{fontSize:"1.5rem",cursor:"pointer",marginLeft:"20px",color:"#cfc",border:"none",background:"transparent"}});function ke(t){const e=We(),[i,n]=m.exports.useState(void 0);return p(G,{children:[i&&g(xe,{text:i,okButton:!0,onClose:()=>n(void 0)}),g("ul",{className:e.menu,children:t.items.filter(o=>o.condition===void 0||o.condition).map(o=>p("li",{children:[g("button",{className:e.menuButton,onClick:o.onClick,children:o.text}),o.tooltip&&g("button",{className:e.tooltip,onClick:()=>n(o.tooltip),children:"(?)"})]},o.text))})]})}const W={ships:[{id:1,size:2,name:"Patrol Boat"},{id:2,size:3,name:"Destroyer"},{id:3,size:3,name:"Submarine"},{id:4,size:4,name:"Battleship"},{id:5,size:5,name:"Aircraft Carrier"}],gridSize:7,streak:!1,shots:1,shotPerShip:!1,mines:0},Ye={title:"Basic",id:0,description:"Basic rules with no modifications",settings:W},qe={title:"Streak",id:1,description:"Fire again after landing a hit",settings:I(P({},W),{streak:!0})},Xe={title:"Barrage",id:2,description:"Fire 4 shots each turn",settings:I(P({},W),{shots:4})},Ze={title:"Salvo",id:3,description:"Fire 1 shot for each surviving ship",settings:I(P({},W),{shotPerShip:!0})},_e={title:"Minefield",id:4,description:"Place 5 mines that explode when hit by the enemy, damaging enemy ships",settings:I(P({},W),{mines:5})},Qe={[0]:Ye,[1]:qe,[2]:Xe,[3]:Ze,[4]:_e};function Ke(){return Object.values(Qe)}function ge(t){const e=Ke().map(i=>({text:i.title,onClick:()=>t.onSelection(i),tooltip:i.description}));return e.push({text:"Back",onClick:t.onCancel}),g(ke,{items:e})}const Ue=M({heading:{fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"3rem",margin:0,padding:{top:10,bottom:10,left:20}},statusText:{fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"1.5rem",padding:{left:20}},buttonStyle:{fontSize:"1.2rem",border:"2px solid black",padding:{top:4,bottom:4,left:10,right:10},margin:{left:20},cursor:"pointer",color:"#ccc",backgroundColor:"#333","&:hover":{backgroundColor:"#555"}}});function Je(t){const e=Ue(),[i,n]=m.exports.useState(!1),[o,s]=m.exports.useState(0),r=a=>{var d,u;n(!0),(d=t.socket)==null||d.once("join-game",h=>{t.onNewGame(new Ae(t.socket,h))}),(u=t.socket)==null||u.emit("quick-connect",a)},l=()=>{var a,d;(a=t.socket)==null||a.emit("cancel-quick-connect"),(d=t.socket)==null||d.removeAllListeners("join-game"),n(!1)},c=a=>{t.onNewGame(new Ge(a))};return p(G,{children:[g("h1",{className:e.heading,children:"Hexships"}),i&&p(G,{children:[g("p",{className:e.statusText,children:"Searching for opponent..."}),g("button",{className:e.buttonStyle,onClick:l,children:"Cancel"})]}),!i&&p(G,{children:[o===0&&g(ke,{items:[{text:"Versus AI",onClick:()=>s(1)},{text:"Find Opponent",onClick:()=>s(2),condition:t.isConnected}]}),o===1&&g(ge,{onSelection:a=>c(a.settings),onCancel:()=>s(0)}),o===2&&g(ge,{onSelection:a=>r(a.id),onCancel:()=>s(0)})]})]})}function Z(t,e,i){const n=t.current;if(!n)return;const o=n.getContext("2d");!o||(o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,n.width,n.height),o.scale(e,e),i(o))}const et=M({"@keyframes boardGradient":{from:{backgroundPosition:"0% 50%"},to:{backgroundPosition:"100% 50%"}},canvas:{animationName:"$boardGradient",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"ease",animationDirection:"alternate",position:"absolute",zIndex:1,pointerEvents:"none",background:"linear-gradient(80deg, #00545c 0%, #00405c 30%, #00545c 60%, #00405c 90%)",backgroundSize:"400% 400%",border:"5px solid #242f40",boxSizing:"border-box"}});function tt(t){const e=m.exports.useRef(null),i=et();return m.exports.useEffect(()=>{Z(e,t.uiScale,n=>{n.strokeStyle="black",n.beginPath();const o=Ee(t.gridSize);for(const s of o){const r=Se(s);q(n,k(r[5],T(t.gridDimensions,.5)));for(const l of r)X(n,k(l,T(t.gridDimensions,.5)))}n.stroke()})},[t.gridSize,e,t.uiScale,t.gridDimensions]),g("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:i.canvas,"data-testid":"field-canvas"})}const it=M({canvas:{position:"absolute",zIndex:3,pointerEvents:"none",border:"5px solid transparent",boxSizing:"border-box"}});function nt(t){const e=m.exports.useRef(null),i=it();return m.exports.useEffect(()=>{Z(e,t.uiScale,n=>{var o;n.strokeStyle="grey",n.lineWidth=N,n.lineCap="round",n.beginPath();for(const s of t.ships){const r=j(s),l=E(s.facing),c=k(s,T(l,s.size-1)),a=j(c);q(n,k(r,T(t.gridDimensions,.5))),X(n,k(a,T(t.gridDimensions,.5)))}if(n.stroke(),(o=t.mines)==null?void 0:o.length){n.strokeStyle="black",n.fillStyle="black",n.lineWidth=1,n.lineCap="butt",n.beginPath();const s=16,r=Math.PI*2/s;for(const l of t.mines){const c=j(l),a=[];for(let d=0;d<s;d++){const u=d*r,h=N*(d%2?.3:.8);a.push(k(c,{x:Math.cos(u)*h,y:Math.sin(u)*h},T(t.gridDimensions,.5)))}q(n,a[s-1]);for(const d of a)X(n,d)}n.fill()}})},[t.ships,t.mines,e,t.uiScale,t.gridDimensions]),g("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:i.canvas,"data-testid":"ships-canvas"})}const st=M({canvas:{position:"absolute",zIndex:4,pointerEvents:"none",border:"5px solid transparent",boxSizing:"border-box"}});function ot(t){const e=m.exports.useRef(null),i=st();return m.exports.useEffect(()=>{Z(e,t.uiScale,n=>{n.strokeStyle="black";for(const o of t.markers){n.fillStyle=o.type===H.Hit?"red":"white",n.beginPath();const s=k(j(o),T(t.gridDimensions,.5));n.arc(s.x,s.y,N*.4,0,Math.PI*2),n.stroke(),n.fill()}})},[t.markers,e,t.uiScale,t.gridDimensions]),g("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:i.canvas,"data-testid":"marker-canvas"})}const rt=M({canvas:{position:"absolute",zIndex:2,border:"5px solid transparent",boxSizing:"border-box"}});function at(t){const e=m.exports.useRef(null),[i,n]=m.exports.useState(null),[o,s]=m.exports.useState(void 0),r=rt();m.exports.useEffect(()=>{Z(e,t.uiScale,u=>{const h=(f,x)=>{const R=Se(f);u.fillStyle=x,u.beginPath(),q(u,k(R[5],T(t.gridDimensions,.5)));for(const F of R)X(u,k(F,T(t.gridDimensions,.5)));u.fill()};if(t.overlayStyle&&(e==null?void 0:e.current)&&(u.fillStyle=t.overlayStyle,u.fillRect(0,0,999999,999999)),i&&o&&h(i,o),t.highlightTiles)for(const f of t.highlightTiles)h(f,f.style)})},[e,t.highlightTiles,i,o,t.uiScale,t.gridDimensions,t.overlayStyle]);const l=u=>{const h=u.target.getBoundingClientRect(),f=k(T({x:u.clientX,y:u.clientY},1/t.uiScale),T(t.gridDimensions,-.5),T(h,-1/t.uiScale));return Be(f)},c=u=>{const h=l(u);z(h,t.gridSize)&&t.onSelectTile&&t.onSelectTile(h)},a=u=>{const h=l(u);n(z(h,t.gridSize)?h:null),s(t.mouseHighlightStyle?t.mouseHighlightStyle(h):void 0)},d=()=>{n(null)};return g("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:r.canvas,onClick:c,onMouseMove:a,onMouseLeave:d,"data-testid":"interaction-canvas"})}const lt=M({board:{position:"relative",width:"100%",maxHeight:"100%",aspectRatio:.86,overflow:"hidden","@media (max-width: 640px)":{maxWidth:"100%",height:"100%"},gridArea:t=>t.gridArea}});function se(t){var r,l;const e=m.exports.useRef(null),[i,n]=m.exports.useState(0),o=lt(t);m.exports.useEffect(()=>{const c=()=>{var a,d;n(Math.min((((a=e==null?void 0:e.current)==null?void 0:a.clientWidth)||0)/420,(((d=e==null?void 0:e.current)==null?void 0:d.clientHeight)||0)/500))};return window.addEventListener("resize",c),c(),()=>{window.removeEventListener("resize",c)}},[e]);const s=Ie(t.gridSize);return p("div",{className:o.board,ref:e,children:[g(tt,{gridSize:t.gridSize,uiScale:i,gridDimensions:s}),(!!((r=t.highlightTiles)==null?void 0:r.length)||t.onSelectTile||t.mouseHighlightStyle)&&g(at,{gridSize:t.gridSize,onSelectTile:t.onSelectTile,highlightTiles:t.highlightTiles,mouseHighlightStyle:t.mouseHighlightStyle,uiScale:i,gridDimensions:s,overlayStyle:t.overlayStyle}),!!(t.ships||t.mines)&&g(nt,{ships:t.ships||[],mines:t.mines||[],uiScale:i,gridDimensions:s}),!!((l=t.markers)==null?void 0:l.length)&&g(ot,{markers:t.markers,uiScale:i,gridDimensions:s})]})}const ne=640,ct=M({container:{display:"inline-block",[`@media (max-width: ${ne}px)`]:{width:"100%"}},panel:{margin:0,padding:0,listStyleType:"none",width:"100%"},shipList:{display:"grid",gridTemplateRows:"repeat(6, 1fr)",[`@media (max-width: ${ne}px)`]:{gridTemplateRows:"repeat(2, 1fr)",gridTemplateColumns:"repeat(3, 1fr)"}},ship:{border:"2px solid black",background:"transparent",color:"#ccc",cursor:"pointer",textAlign:"left",boxSizing:"border-box",margin:{bottom:5},padding:{left:10,right:10,top:5,bottom:5},"@media (max-width: 560px)":{padding:{left:4,right:4,top:2,bottom:2}},"& div":{fontSize:"1.5rem","@media (max-width: 560px)":{fontSize:"1.1rem"}},"& span":{fontSize:"1rem",display:"inline-block","@media (max-width: 560px)":{fontSize:"0.8rem"}}},selectedShip:{backgroundColor:"#0050d4"},mines:{color:"#ccc",fontSize:"1.5rem",fontFamily:"sans-serif"},placedShip:{borderColor:"#ccc"},actionContainer:{display:"flex",justifyContent:"space-between"},actionButton:{border:"1px solid black",color:"#ccc",background:"#0050d4",fontSize:"1.5rem",cursor:"pointer","&:first-of-type":{marginRight:20},"&:disabled":{cursor:"default",background:"#999"},[`@media (max-width: ${ne}px)`]:{alignSelf:"stretch",fontSize:"1rem"}}});function ht(t){const e=ct();return p("div",{className:e.container,children:[t.mines===void 0?g("div",{className:e.shipList,children:t.ships.map(i=>p("button",{onClick:()=>t.onSelected(i.id),className:`${e.ship} ${i.id===t.selectedId?e.selectedShip:""} ${t.placedIds.indexOf(i.id)===-1?"":e.placedShip}`,children:[g("div",{children:i.name}),p("span",{children:["Size: ",i.size]})]},i.id))}):p("p",{className:e.mines,children:[t.mines," Mine",t.mines===1?"":"s"," remaining"]}),p("div",{className:e.actionContainer,children:[t.mines===void 0&&g("button",{className:e.actionButton,onClick:t.onRotated,disabled:!t.canRotate,children:"Rotate"}),g("button",{className:e.actionButton,onClick:t.onConfirm,disabled:!t.placementValid,children:"Confirm"})]})]})}const dt=M({wrapper:{display:"grid",gridTemplateColumns:"5fr 1fr",gridTemplateRows:"100%",width:"100%",height:"100%",columnGap:"10px","@media (max-width: 640px)":{gridTemplateColumns:"100%",gridTemplateRows:"5fr 1fr",rowGap:"10px"}}});function ut(t){const[e,i]=m.exports.useState([]),[n,o]=m.exports.useState([]),[s,r]=m.exports.useState(void 0),[l,c]=m.exports.useState(void 0),[a,d]=m.exports.useState(0),u=dt(),h=Object.values(e);(s==null?void 0:s.ship)&&h.push(s.ship);const f=!!(s==null?void 0:s.ship)&&ye(s.ship,Object.values(e),t.gameSettings.gridSize),x=a===0?h.length===t.gameSettings.ships.length&&ae(h,t.gameSettings.gridSize):n.length===t.gameSettings.mines,R=f?"green":"red",F=l?[{x:l.x,y:l.y,style:R}]:[],V=a===1?t.gameSettings.mines-n.length:void 0,L=y=>{if(y!==(s==null?void 0:s.id)){const w=P({},e);(s==null?void 0:s.ship)&&(w[s.id]=s.ship),e[y]?(r({id:y,ship:e[y]}),c(e[y]),delete w[y]):(r({id:y,ship:void 0}),c(void 0)),i(w)}},_=()=>{(s==null?void 0:s.ship)&&r({id:s.id,ship:I(P({},s.ship),{facing:(s.ship.facing+1)%6})})},Q=()=>{x&&(a===1||t.gameSettings.mines===0?t.onFleetPlaced({ships:h,mines:n}):(d(1),c(void 0)))},K=y=>{if(s){if(s.ship)r({id:s.id,ship:I(P({},s.ship),{x:y.x,y:y.y})});else{const w=t.gameSettings.ships.find(O=>O.id===s.id);w&&r({id:s.id,ship:{x:y.x,y:y.y,size:w.size,facing:oe.positiveX,hits:0,name:w.name,definitionId:w.id}})}c(y)}},U=y=>{if(!h.map(A).flat().some(O=>b(O,y))){const O=n.findIndex(B=>b(B,y));if(O===-1)n.length<t.gameSettings.mines&&o([...n,y]);else{const B=[...n];B.splice(O,1),o(B)}}},J=y=>{a===0?K(y):a===1&&U(y)},ee=()=>(s==null?void 0:s.id)||a===1?"orange":void 0;return p("div",{className:u.wrapper,children:[g(se,{gridSize:t.gameSettings.gridSize,ships:h,mines:n,onSelectTile:J,highlightTiles:F,mouseHighlightStyle:ee}),g(ht,{ships:t.gameSettings.ships,mines:V,placedIds:Object.keys(e).map(Number),selectedId:s==null?void 0:s.id,placementValid:x,canRotate:!!s,onSelected:L,onRotated:_,onConfirm:Q})]})}const gt=M({statusPanel:{position:"relative",padding:{top:10,left:10,right:10,bottom:60},boxSizing:"border-box",minHeight:90,width:"100%",maxWidth:200,gridArea:"panel","@media (max-width: 640px)":{padding:0},display:"grid",gridTemplateColumns:"100%",gridTemplateRows:"repeat(7, 1fr)"},info:{fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"2rem",margin:0,"@media (max-width: 640px)":{fontSize:"1rem"}},enemyShipHeader:{fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"1.6rem",margin:{top:10,bottom:0},"@media (max-width: 640px)":{fontSize:"0.8rem"}},enemyShips:{display:"grid",gridTemplateColumns:"100%",gridTemplateRows:"repeat(6, 1fr)","@media (max-width: 640px)":{gridTemplateColumns:"1fr 1fr",gridTemplateRows:"repeat(3, 1fr)"}},enemyShip:{border:"2px solid black",color:"#ccc",fontFamily:"sans-serif",fontSize:"1.2rem",position:"relative",padding:4,margin:{top:5},"@media (max-width: 640px)":{fontSize:"0.6rem",padding:2}},enemyShipSunk:{border:"2px solid red","&:after":{width:"100%",height:"100%",display:"inline-block",position:"absolute",top:0,left:0,content:'""',background:"linear-gradient(10deg, transparent 47%, red 47%, red 53%, transparent 53%), linear-gradient(170deg, transparent 47%, red 47%, red 53%, transparent 53%)"}},fire:{border:"2px solid #ccc",cursor:"pointer",color:"white",fontSize:"1.5rem",textShadow:"1px 1px 0 black",background:"radial-gradient(#ff8000, #ff0000)",textTransform:"uppercase","&:hover":{background:"radial-gradient(#ffa447, #ff4747)"},"&:disabled":{color:"#aaa",background:"#777",cursor:"default"}},shotsRemaining:{color:"#ccc",fontFamily:"sans-serif",fontSize:"1.2rem","@media (max-width: 640px)":{fontSize:"0.6rem"}}});function mt(t){var i;const e=gt();return p("div",{className:e.statusPanel,children:[t.statusMessage&&g("p",{className:e.info,children:t.statusMessage}),((i=t.ships)==null?void 0:i.length)&&p(G,{children:[g("p",{className:e.enemyShipHeader,children:"Enemy Ships"}),p("div",{className:e.enemyShips,children:[t.ships.map(n=>p("div",{className:`${e.enemyShip} ${t.sunkShipIds&&t.sunkShipIds.indexOf(n.id)!==-1?e.enemyShipSunk:""}`,children:[n.name," (",n.size,")"]},n.id)),t.fireButtonVisible&&p(G,{children:[g("button",{className:e.fire,onClick:t.onFireClick,disabled:!t.fireButtonEnabled,children:"Fire"}),!!t.shotsRemaining&&p("p",{className:e.shotsRemaining,children:[t.shotsRemaining," shot",t.shotsRemaining===1?"":"s"," remaining"]})]})]})]})]})}const ft=M({wrapper:{display:"grid",gridTemplateRows:"100%",gridTemplateColumns:"4fr 4fr 1fr",width:"100%",height:"100%",gridTemplateAreas:'"friend enemy panel"',"@media (max-width: 640px)":{gridTemplateColumns:"8fr 1fr",gridTemplateRows:"4fr 3fr",gridTemplateAreas:'"enemy enemy" "friend panel"'}},menuButton:{position:"absolute",left:10,top:10,zIndex:10,border:"2px solid white",background:"#333",color:"#ccc",fontSize:"1rem"}});function St(t){const[e,i]=m.exports.useState(void 0),[n,o]=m.exports.useState(0),[s,r]=m.exports.useState([]),[l,c]=m.exports.useState(!1),[a,d]=m.exports.useState([]),[u,h]=m.exports.useState([]),f=ft(),x=t.gameInterface.getSettings();m.exports.useEffect(()=>{const S=v=>{var ce;i(I(P({},v),{ownMarkers:v.ownMarkers.slice(0),opponentMarkers:v.opponentMarkers.slice(0),ownShips:v.ownShips.slice(0),isOwnTurn:v.isOwnTurn,sunkEnemies:v.sunkEnemies.slice(0)}));const D=v.opponentMarkers.length-a.length;D>0&&(h(v.opponentMarkers.slice(-D)),d([...v.opponentMarkers]));let Y=0;v.gameWon||v.gameLost?Y=3:((ce=v.ownShips)==null?void 0:ce.length)&&(v.opponentShipsPlaced?Y=2:Y=1),o(Y)};return t.gameInterface.onStateChange(S),()=>{t.gameInterface.offStateChange(S)}},[t.gameInterface,e,a.length]);const R=S=>{t.gameInterface.setFleet(S)},F=S=>!(e==null?void 0:e.ownMarkers.some(v=>b(S,v))),V=(e==null?void 0:e.isOwnTurn)&&n===2,L=e?le(x,e):0,_=S=>{if(V&&F(S)){const v=s.findIndex(D=>b(D,S));if(v===-1)L===1?r([S]):s.length<L&&r([...s,S]);else{const D=[...s];D.splice(v,1),r(D)}}},Q=S=>V&&F(S)?"orange":void 0,K=()=>{s.length===L&&s.every(S=>F(S))&&(t.gameInterface.fireShots(s),r([]))},U=()=>{c(!0)},J=()=>{t.gameInterface.leaveGame(),t.onExit()},ee=()=>{c(!1)},y=u.map(S=>({x:S.x,y:S.y,style:"orange"}));let w;n===2?w=(e==null?void 0:e.isOwnTurn)?"Take your shot":"Enemy's turn":n===3?(e==null?void 0:e.opponentLeft)?w="Your opponent left":w=`You have ${(e==null?void 0:e.gameWon)?"Won":"Lost"}`:n===1&&(w="Enemy placing ships");let O;(e==null?void 0:e.gameWon)?O=e.ownMarkers.filter(S=>S.type===H.Hit).map(S=>({x:S.x,y:S.y,style:"red"})):O=s.map(S=>({x:S.x,y:S.y,style:"red"}));let B;(e==null?void 0:e.gameWon)?B="rgba(0, 255, 0, 0.3)":(e==null?void 0:e.gameLost)&&(B="rgba(255, 0, 0, 0.3)");const be=V&&(x.shots>1||x.shotPerShip)?L-s.length:void 0;return p(G,{children:[l&&g(xe,{text:"Are you sure you want to end the game?",onOk:J,onClose:ee,okButton:!0,cancelButton:!0}),g("button",{className:f.menuButton,onClick:U,children:"Menu"}),n===0?g(ut,{gameSettings:x,onFleetPlaced:R}):p("div",{className:f.wrapper,children:[g(se,{gridSize:x.gridSize,ships:e==null?void 0:e.ownShips,mines:e==null?void 0:e.ownMines,markers:e==null?void 0:e.opponentMarkers,highlightTiles:y,gridArea:"friend",overlayStyle:B}),g(se,{gridSize:x.gridSize,ships:e==null?void 0:e.opponentShips,mines:e==null?void 0:e.opponentMines,markers:e==null?void 0:e.ownMarkers,onSelectTile:_,highlightTiles:O,mouseHighlightStyle:Q,gridArea:"enemy",overlayStyle:B}),g(mt,{statusMessage:w,ships:n===1?void 0:x.ships,sunkShipIds:e==null?void 0:e.sunkEnemies,fireButtonVisible:n===2,fireButtonEnabled:!!(s.length===L&&(e==null?void 0:e.isOwnTurn)),shotsRemaining:be,onFireClick:K})]})]})}const yt=M({container:{backgroundColor:"#022866",width:"100%",height:"100%",overflow:"auto"}});function pt(){const[t,e]=m.exports.useState(null),[i,n]=m.exports.useState(!1),[o,s]=m.exports.useState(void 0),r=yt();m.exports.useEffect(()=>{const a=Te();s(a),a.on("connect",()=>{n(!0)})},[]);const l=a=>{e(a)},c=()=>{e(null)};return g("div",{className:r.container,children:t?g(St,{gameInterface:t,onExit:c}):g(Je,{onNewGame:l,socket:o,isConnected:i})})}me.setAppElement("#root");Pe.render(g(He.StrictMode,{children:g(pt,{})}),document.getElementById("root"));
