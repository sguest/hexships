var Ge=Object.defineProperty,Ae=Object.defineProperties;var We=Object.getOwnPropertyDescriptors;var ze=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var le=(t,e,i)=>e in t?Ge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,b=(t,e)=>{for(var i in e||(e={}))je.call(e,i)&&le(t,i,e[i]);if(ze)for(var i of ze(e))Ve.call(e,i)&&le(t,i,e[i]);return t},x=(t,e)=>Ae(t,We(e));var E=(t,e,i)=>(le(t,typeof e!="symbol"?e+"":e,i),i);import{c as N,j as g,R as Me,a as r,r as f,F as I,l as Xe,b as Ye,d as qe}from"./vendor.dc3d6da2.js";const Ke=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerpolicy&&(n.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?n.credentials="include":a.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=i(a);fetch(a.href,n)}};Ke();var be=(t=>(t[t.positiveX=0]="positiveX",t[t.positiveY=1]="positiveY",t[t.positiveZ=2]="positiveZ",t[t.negativeX=3]="negativeX",t[t.negativeY=4]="negativeY",t[t.negativeZ=5]="negativeZ",t))(be||{});const Ue={[0]:{x:1,y:0},[1]:{x:0,y:1},[2]:{x:-1,y:1},[3]:{x:-1,y:0},[4]:{x:0,y:-1},[5]:{x:1,y:-1}};function R(t){return Ue[t]}function Pe(){return[0,1,2,3,4,5]}function C(...t){const e={x:0,y:0};for(const i of t)e.x+=i.x,e.y+=i.y;return e}function T(t,e){return{x:t.x*e,y:t.y*e}}function z(t,e){return t.x===e.x&&t.y===e.y}function Q(t,e){t.moveTo(e.x,e.y)}function ee(t,e){t.lineTo(e.x,e.y)}const pe=Math.sqrt(3);function F(t){return 140/t}function X(t,e){return{x:1.5*t.x*F(e),y:(t.y+.5*t.x)*F(e)*pe}}function Te(t,e){const i=X(t,e);return[...Array(6).keys()].map(s=>{const a=Math.PI/3*s;return{x:i.x+F(e)*Math.cos(a),y:i.y+F(e)*Math.sin(a)}})}function Ze(t){return{x:t*3*F(t),y:t*2*F(t)*pe}}function _e(t){const e=-t.x-t.y;let i=Math.round(t.x),s=Math.round(t.y);const a=Math.round(e),n=Math.abs(i-t.x),o=Math.abs(s-t.y),l=Math.abs(a-e);return n>o&&n>l?i=-s-a:o>l&&(s=-i-a),{x:i,y:s}}function Je(t,e){return _e({x:t.x*2/3/F(e),y:(t.x*-1/3+t.y*pe/3)/F(e)})}function P(t,e){const i=-t.x-t.y;return t.x>-e&&t.x<e&&t.y>-e&&t.y<e&&i>-e&&i<e}function Qe(t){const e=[];for(let i=-t+1;i<t;i++)for(let s=-t+1;s<t;s++)P({x:i,y:s},t)&&e.push({x:i,y:s});return e}function et(t,e){return Pe().map(i=>{const s=R(i);return C(t,s)}).filter(i=>P(i,e))}function j(t){const e=R(t.facing);let i={x:t.x,y:t.y};const s=[{x:t.x,y:t.y}];for(let a=1;a<t.size;a++)i=C(i,e),s.push(i);return s}function Ie(t,e,i){const s=j(t),a=e.map(n=>j(n)).flat();for(const n of s){if(!P(n,i))return!1;for(const o of a)if(z(n,o))return!1}return!0}function xe(t,e){for(let i=0;i<t.length;i++)if(!Ie(t[i],t.slice(i+1),e))return!1;return!0}var B=(t=>(t[t.Hit=0]="Hit",t[t.Miss=1]="Miss",t))(B||{});function Be(t){return t.filter(e=>e.hits===e.size)}function ke(t,e){return t.shotPerShip?e.ownShips.length-Be(e.ownShips).length:t.shots}class tt{constructor(e,i){E(this,"players");E(this,"activePlayerId");this.gameSettings=e,this.subscriber=i,this.players=[{ships:[],mines:[],markers:[],active:!0},{ships:[],mines:[],markers:[],active:!0}],this.activePlayerId=0}getLocalState(e){const i=+!e,s=this.playerLost(i),a=this.playerLost(e),n=a||s;return{ownShips:this.players[e].ships,ownMarkers:this.players[e].markers,ownMines:this.players[e].mines,opponentShips:n?this.players[i].ships:void 0,opponentMarkers:this.players[i].markers,opponentMines:this.players[i].mines.filter(o=>n||this.players[e].markers.some(l=>z(o,l))),isOwnTurn:e===this.activePlayerId&&!!this.players[e].ships.length,sunkEnemies:Be(this.players[i].ships).map(o=>o.definitionId),gameWon:s,gameLost:a,opponentShipsPlaced:!!this.players[i].ships.length,opponentLeft:!this.players[i].active}}loadFromState(e){this.players=e.players,this.activePlayerId=e.activePlayerId}getState(){return{players:this.players,activePlayerId:this.activePlayerId}}playerLost(e){const i=this.players[e];return!i.active||!!i.ships.length&&i.ships.every(s=>s.hits===s.size)}validateShipPlacement(e){const i=this.gameSettings.ships.slice(0),s=[];for(const a of e){const n=i.findIndex(l=>l.id===a.definitionId);if(n===-1)return[];const o=i[n];s.push({x:a.x,y:a.y,size:o.size,facing:a.facing,hits:0,name:o.name,definitionId:a.definitionId}),i.splice(n,1)}return i.length?[]:xe(s,this.gameSettings.gridSize)?s:[]}validateMinePlacement(e,i){if(e.length!==this.gameSettings.mines)return!1;const s=i.map(a=>j(a)).flat();for(const a of e)if(s.some(n=>z(n,a))||e.some(n=>n!==a&&z(a,n))||!P(a,this.gameSettings.gridSize))return!1;return!0}setFleet(e,i){if(!this.players[e])return;const s=this.validateShipPlacement(i.ships);s.length&&this.validateMinePlacement(i.mines,s)?(this.players[e].ships=s,this.players[e].mines=i.mines.slice(),this.allShipsPlaced()?this.broadcastState():this.sendState(e)):this.sendState(e)}tryHit(e,i){for(const s of e)for(const a of j(s))if(z(a,i))return s.hits++,!0;return!1}fireShots(e,i){const s=this.players[e],a=this.getLocalState(e),n=+!e;if(this.activePlayerId===e&&!this.playerLost(e)&&!this.playerLost(n)&&this.allShipsPlaced()&&i.length===ke(this.gameSettings,a)&&i.every(l=>!!l&&P(l,this.gameSettings.gridSize)&&!s.markers.some(d=>z(d,l))&&!i.some(d=>d!==l&&z(l,d)))){let l=!1;for(const d of i){const c=this.tryHit(this.players[n].ships,d);if(s.markers.push({x:d.x,y:d.y,type:c?B.Hit:B.Miss}),l=l||c,this.players[n].mines.some(m=>z(m,d)))for(const m of[...et(d,this.gameSettings.gridSize),d])this.players[n].markers.some(u=>z(u,m))||this.players[n].markers.push({x:m.x,y:m.y,type:this.tryHit(this.players[e].ships,m)?B.Hit:B.Miss})}(!this.gameSettings.streak||!l)&&(this.activePlayerId=n),this.broadcastState()}else this.sendState(e)}leaveGame(e){const i=+!e;!this.playerLost(e)&&!this.playerLost(i)&&(this.players[e].active=!1,this.broadcastState())}sendState(e){this.subscriber(e,this.getLocalState(e))}broadcastState(){for(let e=0;e<this.players.length;e++)this.sendState(e)}allShipsPlaced(){return this.players.every(e=>e.ships.length)}}function G(t,e){return Math.floor(Math.random()*(e-t+1))+t}function it(t){const e=Object.keys(t).map(a=>Number.parseInt(a)).filter(a=>!Number.isNaN(a)),i=Math.floor(Math.random()*e.length);return e[i]}class nt{constructor(e){E(this,"state");this.gameSettings=e,this.state={ownShots:{},ownShotCount:0,priorityHits:[],trackedHits:[],sunkShips:[]}}generateFleet(){const e=[],i=-this.gameSettings.gridSize,s=-this.gameSettings.gridSize,a=this.gameSettings.gridSize,n=this.gameSettings.gridSize;for(const d of this.gameSettings.ships){let c;do c={size:d.size,name:d.name,x:G(i,a),y:G(s,n),facing:it(be),hits:0,definitionId:d.id};while(!xe([...e,c],this.gameSettings.gridSize));e.push(c)}const o=[],l=e.map(j).flat();for(let d=0;d<this.gameSettings.mines;d++){let c;do c={x:G(i,a),y:G(s,n)};while(!P(c,this.gameSettings.gridSize)||o.some(m=>z(m,c)||l.some(u=>z(u,c))));o.push(c)}return{ships:e,mines:o}}updateGameState(e){var i,s;if(!!((i=e.ownMarkers)==null?void 0:i.length))for(;e.ownMarkers.length>this.state.ownShotCount;){const a=e.ownMarkers[this.state.ownShotCount];if(this.getOwnShot(a)===void 0&&(this.state.ownShots[a.x]=this.state.ownShots[a.x]||{},this.state.ownShots[a.x][a.y]=a.type,a.type===B.Hit)){if(e.sunkEnemies.length===this.state.sunkShips.length)this.state.priorityHits.push(a),this.state.trackedHits.push(a);else for(const n of e.sunkEnemies)if(this.state.sunkShips.indexOf(n)===-1){this.state.sunkShips.push(n);const o=(s=this.gameSettings.ships.find(l=>l.id===n))==null?void 0:s.size;if(o){let l=!1;for(let d=0;d<6;d++)if(!l){const c=R(d);let m=a;const u=[m];for(let h=0;h<o;h++)m=C(m,c),this.state.trackedHits.find(p=>z(p,m))&&u.push(m);if(u.length===o){l=!0;for(const h of u){let S=this.state.trackedHits.findIndex(p=>z(p,h));S!==-1&&this.state.trackedHits.splice(S,1),S=this.state.priorityHits.findIndex(p=>z(p,h)),S!==-1&&this.state.priorityHits.splice(S,1)}}}}}}this.state.ownShotCount++}}getShots(e){const i=[];for(;this.state.priorityHits.length;){const o=this.state.priorityHits[0],l=Pe();for(;l.length;){const c=l.splice(G(0,l.length-1),1)[0];let m=R(c);const u=C(o,m);let h=o;if(this.state.trackedHits.find(S=>z(S,u))){for(;this.getOwnShot(h)===B.Hit&&P(h,this.gameSettings.gridSize);)h=C(h,m);for(;this.getOwnShot(h)===void 0&&P(h,this.gameSettings.gridSize);)i.push(h),h=C(h,m);for(h=o,m=R((c+3)%6);this.getOwnShot(h)===B.Hit&&P(h,this.gameSettings.gridSize);)h=C(h,m);for(;this.getOwnShot(h)===void 0&&P(h,this.gameSettings.gridSize);)i.push(h),h=C(h,m)}}if(i.length>=e)return i.slice(0,e);const d=[];for(let c=0;c<6;c++){const m=R(c),u=C(o,m);this.getOwnShot(u)===void 0&&P(u,this.gameSettings.gridSize)&&d.push(u)}for(;d.length;)i.push(d.splice(G(0,d.length-1),1)[0]);if(i.length>=e)return i.slice(0,e);this.state.priorityHits.splice(0,1)}const s=this.gameSettings.ships.filter(o=>!this.state.sunkShips.some(l=>o.id===l)),a=Math.min(...s.map(o=>o.size)),n=[];for(let o=-this.gameSettings.gridSize;o<=this.gameSettings.gridSize;o++)for(let l=-this.gameSettings.gridSize;l<=this.gameSettings.gridSize;l++){const d={x:o,y:l};if(P(d,this.gameSettings.gridSize)&&this.getOwnShot(d)===void 0)for(let c=0;c<3;c++){const m=R(c);let u=!0;const h=[d];let S=d;for(let p=1;p<a;p++){S=C(S,m);const L=this.getOwnShot(S);!P(S,this.gameSettings.gridSize)||L===B.Miss?u=!1:L===void 0&&h.push(S)}u&&n.push(...h)}}for(;i.length<e;)i.push(n.splice(G(0,n.length-1),1)[0]);return i}getState(){return this.state}loadFromState(e){this.state=e}getOwnShot(e){return this.state.ownShots[e.x]&&this.state.ownShots[e.x][e.y]}}function ce(t,e){const i=window.btoa(encodeURIComponent(JSON.stringify(e)));localStorage.setItem(t,i)}function de(t){try{const e=localStorage.getItem(t);return(e==null?void 0:e.length)?JSON.parse(decodeURIComponent(window.atob(e))):e}catch{return null}}const _=0,J=1,me="localgamestate",ge="localgamesettings",ue="localaisettings";class Fe{constructor(e){E(this,"stateSubscriptions");E(this,"gameManager");E(this,"aiPlayer");E(this,"staleSubscriber",!1);this.gameSettings=e,this.stateSubscriptions=[],this.gameManager=new tt(e,(i,s)=>this.sendState(i,s)),this.aiPlayer=new nt(e),ce(ge,e)}onStateChange(e){this.stateSubscriptions.push(e),this.staleSubscriber&&(e(this.gameManager.getLocalState(_),!0),this.staleSubscriber=!1)}offStateChange(e){const i=this.stateSubscriptions.indexOf(e);i>=0&&this.stateSubscriptions.splice(i,1)}setFleet(e){this.gameManager.setFleet(_,e),this.gameManager.setFleet(J,this.aiPlayer.generateFleet())}fireShots(e){this.gameManager.fireShots(_,e)}leaveGame(){localStorage.removeItem(ue),localStorage.removeItem(ge),localStorage.removeItem(me)}getSettings(){return this.gameSettings}loadState(e,i){this.gameManager.loadFromState(e),this.aiPlayer.loadFromState(i),this.sendState(J,this.gameManager.getLocalState(J)),this.staleSubscriber=!0}sendState(e,i){ce(me,this.gameManager.getState()),e===_?this.stateSubscriptions.forEach(s=>s(i,!1)):(this.aiPlayer.updateGameState(i),i.isOwnTurn&&!i.gameLost&&!i.gameWon&&setTimeout(()=>{this.takeEnemyShot(i)},1e3),ce(ue,this.aiPlayer.getState()))}takeEnemyShot(e){this.gameManager.fireShots(J,this.aiPlayer.getShots(ke(this.gameSettings,e)))}}function st(){const t=de(me),e=de(ge),i=de(ue);if(t&&e&&i&&typeof t=="object"&&typeof e=="object"&&typeof i=="object"){const s=new Fe(e);return s.loadState(t,i),s}}function He(t){var e,i;if(!t.shotPerShip&&t.shots<1||t.mines<0||!((e=t.ships)==null?void 0:e.length))return!1;for(const s of t.ships)if(!((i=s.name)==null?void 0:i.trim())||s.size<1)return!1;return!0}const U={ships:[{id:1,size:2,name:"Patrol Boat"},{id:2,size:3,name:"Destroyer"},{id:3,size:3,name:"Submarine"},{id:4,size:4,name:"Battleship"},{id:5,size:5,name:"Aircraft Carrier"}],gridSize:7,streak:!1,shots:1,shotPerShip:!1,mines:0};var W=(t=>(t[t.Basic=0]="Basic",t[t.Streak=1]="Streak",t[t.Barrage=2]="Barrage",t[t.Salvo=3]="Salvo",t[t.Minefield=4]="Minefield",t[t.Custom=5]="Custom",t))(W||{});const Y={title:"Basic",id:0,description:"Basic rules with no modifications",settings:U},at={title:"Streak",id:1,description:"Fire again after landing a hit",settings:x(b({},U),{streak:!0})},ot={title:"Barrage",id:2,description:"Fire 4 shots each turn",settings:x(b({},U),{shots:4})},rt={title:"Salvo",id:3,description:"Fire 1 shot for each surviving ship",settings:x(b({},U),{shotPerShip:!0})},lt={title:"Minefield",id:4,description:"Place 5 mines that explode when hit by the enemy, damaging enemy ships",settings:x(b({},U),{mines:5})},Le={title:"Custom",id:5,description:"Custom settings"},Oe={[0]:Y,[1]:at,[2]:ot,[3]:rt,[4]:lt,[5]:Le};function fe(t){return Oe[t]}function Ee(){return Object.values(Oe).filter(t=>!!t.settings)}const v="#ccc",q=["Big Shoulders Stencil Text","sans-serif"],K={fontSize:"1.2rem",border:"2px solid black",padding:{top:4,bottom:4,left:10,right:10},cursor:"pointer",color:v,backgroundColor:"#333","&:hover":{backgroundColor:"#555"},"&:disabled":{cursor:"default",backgroundColor:"#999"}},Se={border:`1px solid ${v}`,background:"transparent",color:v,padding:3,fontSize:"1rem","& option":{backgroundColor:"#022866"},"&:disabled":{backgroundColor:"#ccc",color:"#666"}},Ne={fontSize:"1.6rem",border:"2px solid black",padding:{top:4,bottom:4,left:10,right:10},cursor:"pointer"},ct=N({buttonContainer:{display:"flex",justifyContent:"space-between"},okButton:x(b({},Ne),{"&:hover":{backgroundColor:"white"}}),cancelButton:x(b({},Ne),{color:v,backgroundColor:"#333","&:hover":{backgroundColor:"#555"}})}),dt={content:{border:"3px solid #ccc",display:"inline-block",background:"#333",color:"white",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:20,fontSize:"1.5rem",fontFamily:"sans-serif",inset:"50% auto auto 50%"},overlay:{zIndex:999}};function Re(t){const e=ct(),i=()=>{t.onClose(),t.onOk&&t.onOk()};return g(Me,{isOpen:!0,onRequestClose:t.onClose,style:dt,children:[typeof t.children=="string"?r("p",{children:t.children}):t.children,g("div",{className:e.buttonContainer,children:[t.okButton&&r("button",{className:e.okButton,onClick:i,children:"OK"}),t.cancelButton&&r("button",{className:e.cancelButton,onClick:t.onClose,children:"Cancel"})]})]})}const ht=N({tooltip:{fontSize:"1.5rem",cursor:"pointer",marginLeft:"20px",color:"#cfc",border:"none",background:"transparent"}});function ve(t){const e=ht(),[i,s]=f.exports.useState(!1);return g(I,{children:[i&&r(Re,{okButton:!0,onClose:()=>s(!1),children:t.children}),r("button",{className:e.tooltip,onClick:()=>s(!0),type:"button",children:"(?)"})]})}const mt=N({menu:{margin:0,padding:{left:20},listStyleType:"none"},menuButton:{background:"transparent",border:"none",fontFamily:q,color:v,fontSize:"1.5rem",cursor:"pointer","&:hover":{color:"#fff"}}});function gt(t){const e=mt();return r("ul",{className:e.menu,children:t.items.filter(i=>i.condition===void 0||i.condition).map(i=>g("li",{children:[r("button",{className:e.menuButton,onClick:i.onClick,children:i.text}),i.tooltip&&r(ve,{children:i.tooltip})]},i.text))})}const ut=N({label:{color:v,fontSize:"1.1rem",fontFamily:"sans-serif",display:"flex",justifyContent:"space-between",alignItems:"flex-start",margin:{bottom:15}},input:x(b({},Se),{width:200,boxSizing:"border-box",maxWidth:"100%",flexShrink:0}),checkbox:{width:20,height:20},addButton:{background:"transparent",border:"none",color:"green",fontSize:"1.5rem",cursor:"pointer",display:"block",marginBottom:10},deleteButton:{background:"transparent",border:"none",color:"red",fontSize:"1.1rem",cursor:"pointer"},shipsHeader:{color:v,fontSize:"1.4rem",fontFamily:"sans-serif"},shipList:{listStyleType:"none",padding:0,margin:0,color:v,fontFamily:"sans-serif",fontSize:"1.1rem","& li":{display:"flex",justifyContent:"space-between",flexWrap:"wrap"},"& input":Se},sizeInput:{maxWidth:100},nameInput:{marginRight:20}});function De(t){const e=ut(),i=n=>{const o=t.settings.ships.findIndex(d=>d.id===n.id),l=t.settings.ships.slice();l[o]=n,t.onSettingsChanged(x(b({},t.settings),{ships:l}))},s=()=>{t.onSettingsChanged(x(b({},t.settings),{ships:[...t.settings.ships,{id:Math.max(...t.settings.ships.map(n=>n.id))+1,name:"",size:2}]}))},a=n=>{const o=t.settings.ships.slice();o.splice(o.findIndex(l=>l.id===n),1),t.onSettingsChanged(x(b({},t.settings),{ships:o}))};return g(I,{children:[g("label",{className:e.label,children:["Number of shots per turn",r("input",{className:e.input,type:"number",min:"1",value:t.settings.shots,onChange:n=>t.onSettingsChanged(x(b({},t.settings),{shots:parseInt(n.target.value)})),disabled:t.settings.shotPerShip})]}),g("label",{className:e.label,children:["One shot per remaining ship",r("input",{className:e.checkbox,type:"checkbox",checked:t.settings.shotPerShip,onChange:n=>t.onSettingsChanged(x(b({},t.settings),{shotPerShip:n.target.checked}))})]}),g("label",{className:e.label,children:["Fire again on hit",r("input",{className:e.checkbox,type:"checkbox",checked:t.settings.streak,onChange:n=>t.onSettingsChanged(x(b({},t.settings),{streak:n.target.checked}))})]}),g("label",{className:e.label,children:["Number of mines",r("input",{className:e.input,type:"number",min:"0",value:t.settings.mines,onChange:n=>t.onSettingsChanged(x(b({},t.settings),{mines:parseInt(n.target.value)}))})]}),g("label",{className:e.label,children:["Field size - tiles from center to corner",r("input",{className:e.input,type:"number",min:"1",value:t.settings.gridSize,onChange:n=>t.onSettingsChanged(x(b({},t.settings),{gridSize:parseInt(n.target.value)}))})]}),r("p",{className:e.shipsHeader,children:"Ships"}),r("ul",{className:e.shipList,children:t.settings.ships.map(n=>g("li",{children:[g("label",{children:["Name ",r("input",{className:e.nameInput,type:"text",value:n.name,onChange:o=>i(x(b({},n),{name:o.target.value}))})]}),g("label",{children:["Size ",r("input",{className:e.sizeInput,type:"number",value:n.size,min:1,onChange:o=>i(x(b({},n),{size:parseInt(o.target.value)}))})]}),r("button",{className:e.deleteButton,type:"button",onClick:()=>a(n.id),children:"X"})]},n.id))}),r("button",{className:e.addButton,type:"button",onClick:s,children:"+"})]})}const ft=N({form:{padding:{left:20,right:20},maxWidth:500},label:{color:v,fontSize:"1.1rem",fontFamily:"sans-serif",display:"flex",justifyContent:"space-between",alignItems:"flex-start",margin:{bottom:15}},input:x(b({},Se),{width:200,boxSizing:"border-box",maxWidth:"100%",flexShrink:0}),button:x(b({},K),{"&:first-of-type":{marginRight:20}})});function St(t){const e=ft(),[i,s]=f.exports.useState(W.Basic),[a,n]=f.exports.useState(Y.settings),[o,l]=f.exports.useState(""),d=()=>{var m,u;i===W.Custom?a&&((m=t.socket)==null||m.emit("add-custom-lobby-game",o,a),t.onCreated()):((u=t.socket)==null||u.emit("add-standard-lobby-game",o,i),t.onCreated())};let c=!0;return o.trim()||(c=!1),i===W.Custom&&!He(a)&&(c=!1),g("form",{className:e.form,children:[g("label",{className:e.label,children:["Game Name",r("input",{className:e.input,type:"text",value:o,onChange:m=>l(m.target.value)})]}),g("label",{className:e.label,children:["Game Mode",r(ve,{children:fe(i).description}),r("select",{className:e.input,value:i,onChange:m=>s(parseInt(m.target.value)),"data-testid":"gamemode",children:[...Ee(),Le].map(m=>r("option",{value:m.id,children:m.title},m.id))})]}),i===W.Custom&&r(I,{children:r(De,{onSettingsChanged:n,settings:a})}),r("button",{className:e.button,onClick:d,disabled:!c,type:"button",children:"Create"}),r("button",{className:e.button,onClick:()=>t.onCancel(),type:"button",children:"Cancel"})]})}const yt=N({item:{fontSize:"1rem",margin:{top:4,bottom:4}}});function bt(t){const e=yt(),i=(a,n)=>a.name===n.name&&a.size===n.size,s=t.settings.ships.length===5&&t.settings.ships.every((a,n)=>i(a,Y.settings.ships[n]));return g(I,{children:[r("p",{className:e.item,children:"Differences from basic rules:"}),t.settings.shotPerShip&&r("p",{className:e.item,children:"1 shot per surviving ship"}),!t.settings.shotPerShip&&t.settings.shots>1&&g("p",{className:e.item,children:[t.settings.shots," shots per turn"]}),t.settings.streak&&r("p",{className:e.item,children:"Fire again after a hit"}),t.settings.mines>0&&g("p",{className:e.item,children:[t.settings.mines," mine",t.settings.mines>1&&"s"]}),t.settings.gridSize!==Y.settings.gridSize&&g("p",{className:e.item,children:["Field size ",t.settings.gridSize," from center to corner"]}),!s&&g("div",{className:e.item,children:["Ships",r("ul",{children:t.settings.ships.map(a=>g("li",{children:[a.name," (size ",a.size,")"]},a.id))})]})]})}const pt=N({button:K,noGamesMessage:{color:v,size:"2rem",fontFamily:"sans-serif",marginLeft:20},list:{listStyle:"none",padding:0,margin:20},game:{border:`1px solid ${v}`,padding:15,width:"100%",maxWidth:400,marginBottom:10},info:{margin:{top:0,bottom:5},color:v,fontSize:"1.2rem",fontFamily:"sans-serif"}});function xt(t){const e=pt(),[i,s]=f.exports.useState(void 0);f.exports.useEffect(()=>{var n;i===void 0&&((n=t.socket)==null||n.emit("enter-lobby",o=>{s(o)}))}),f.exports.useEffect(()=>{var n,o;return(n=t.socket)==null||n.on("add-lobby-game",l=>{i?i.findIndex(d=>d.id===l.id)===-1&&s([...i,l]):s([l])}),(o=t.socket)==null||o.on("remove-lobby-game",l=>{if(i){const d=i.findIndex(c=>c.id===l);if(d>=0){const c=i.slice();c.splice(d),s(c)}}}),()=>{var l,d;(l=t.socket)==null||l.removeAllListeners("add-lobby-game"),(d=t.socket)==null||d.removeAllListeners("remove-lobby-game")}},[t.socket,i]);const a=n=>{var o;(o=t.socket)==null||o.emit("join-lobby-game",n)};return g(I,{children:[!i&&r("p",{className:e.noGamesMessage,children:"Loading game list..."}),!!i&&!i.length&&r("p",{className:e.noGamesMessage,children:"No games found"}),!!(i==null?void 0:i.length)&&r("ul",{className:e.list,children:!!i&&i.map(n=>g("li",{className:e.game,children:[g("p",{className:e.info,children:["Name: ",n.definition.name]}),g("p",{className:e.info,children:["Mode: ",fe(n.definition.mode).title,r(ve,{children:n.definition.mode===W.Custom?r(bt,{settings:n.definition.settings}):fe(n.definition.mode).description})]}),r("button",{className:e.button,onClick:()=>a(n.id),children:"Join"})]},n.id))})]})}const kt=N({heading:{fontFamily:q,color:v,fontSize:"3rem",margin:0,padding:{top:10,bottom:10,left:20}},statusText:{fontFamily:q,color:v,fontSize:"1.5rem",padding:{left:20}},buttonStyle:x(b({},K),{margin:{left:20}}),singlePlayerCustom:{padding:{left:20,right:20},maxWidth:500},playButton:K});function vt(t){const e=kt(),[i,s]=f.exports.useState(0),[a,n]=f.exports.useState(Y.settings),{socket:o}=t,l=S=>{s(5),o==null||o.emit("quick-connect",S)},d=()=>{o==null||o.emit("cancel-quick-connect"),s(4)},c=()=>{o==null||o.emit("remove-lobby-game"),s(3)},m=S=>{t.onNewGame(new Fe(S))},u=S=>Ee().map(p=>({text:p.title,onClick:()=>S(p),tooltip:p.description}));let h=[];return i===0?h=[{text:"Versus AI",onClick:()=>s(1)},{text:"Multiplayer",onClick:()=>s(3),condition:t.isConnected}]:i===1?h=[...u(S=>m(S.settings)),{text:"Custom",onClick:()=>s(2)},{text:"Back",onClick:()=>s(0)}]:i===3?h=[{text:"Quick Match",onClick:()=>s(4)},{text:"Create Game",onClick:()=>s(6)},{text:"Find Game",onClick:()=>s(8)},{text:"Back",onClick:()=>s(0)}]:i===4&&(h=[...u(S=>l(S.id)),{text:"Back",onClick:()=>s(3)}]),g(I,{children:[r("h1",{className:e.heading,children:"Hexships"}),!!h.length&&r(gt,{items:h}),i===2&&g("form",{className:e.singlePlayerCustom,children:[r(De,{onSettingsChanged:n,settings:a}),r("button",{className:e.playButton,onClick:()=>a&&m(a),disabled:!He(a),type:"button",children:"Play"}),r("button",{className:e.buttonStyle,onClick:()=>s(1),type:"button",children:"Cancel"})]}),i===5&&g(I,{children:[r("p",{className:e.statusText,children:"Searching for opponent..."}),r("button",{className:e.buttonStyle,onClick:d,children:"Cancel"})]}),i===6&&r(St,{onCreated:()=>s(7),onCancel:()=>s(3),socket:o}),i===7&&g(I,{children:[r("p",{className:e.statusText,children:"Waiting for opponent..."}),r("button",{className:e.buttonStyle,onClick:c,children:"Cancel"})]}),i===8&&g(I,{children:[r("button",{className:e.buttonStyle,onClick:()=>s(3),children:"Back"}),r(xt,{socket:t.socket})]})]})}function te(t,e,i){const s=t.current;if(!s)return;const a=s.getContext("2d");!a||(a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,s.width,s.height),a.scale(e,e),i(a))}const Ct=N({"@keyframes boardGradient":{from:{backgroundPosition:"0% 50%"},to:{backgroundPosition:"100% 50%"}},canvas:{animationName:"$boardGradient",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"ease",animationDirection:"alternate",position:"absolute",zIndex:1,pointerEvents:"none",background:"linear-gradient(80deg, #00545c 0%, #00405c 30%, #00545c 60%, #00405c 90%)",backgroundSize:"400% 400%",border:"5px solid #242f40",boxSizing:"border-box"}});function wt(t){const e=f.exports.useRef(null),i=Ct();return f.exports.useEffect(()=>{te(e,t.uiScale,s=>{s.strokeStyle="black",s.beginPath();const a=Qe(t.gridSize);for(const n of a){const o=Te(n,t.gridSize);Q(s,C(o[5],T(t.gridDimensions,.5)));for(const l of o)ee(s,C(l,T(t.gridDimensions,.5)))}s.stroke()})},[t.gridSize,e,t.uiScale,t.gridDimensions]),r("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:i.canvas,"data-testid":"field-canvas"})}const zt=N({canvas:{position:"absolute",zIndex:3,pointerEvents:"none",border:"5px solid transparent",boxSizing:"border-box"}});function Nt(t){const e=f.exports.useRef(null),i=zt();return f.exports.useEffect(()=>{te(e,t.uiScale,s=>{var a;s.strokeStyle="grey",s.lineWidth=F(t.gridSize),s.lineCap="round",s.beginPath();for(const n of t.ships){const o=X(n,t.gridSize),l=R(n.facing),d=C(n,T(l,n.size-1)),c=X(d,t.gridSize);Q(s,C(o,T(t.gridDimensions,.5))),ee(s,C(c,T(t.gridDimensions,.5)))}if(s.stroke(),(a=t.mines)==null?void 0:a.length){s.strokeStyle="black",s.fillStyle="black",s.lineWidth=1,s.lineCap="butt",s.beginPath();const n=16,o=Math.PI*2/n;for(const l of t.mines){const d=X(l,t.gridSize),c=[];for(let m=0;m<n;m++){const u=m*o,h=F(t.gridSize)*(m%2?.3:.8);c.push(C(d,{x:Math.cos(u)*h,y:Math.sin(u)*h},T(t.gridDimensions,.5)))}Q(s,c[n-1]);for(const m of c)ee(s,m)}s.fill()}})},[t.ships,t.mines,e,t.uiScale,t.gridDimensions,t.gridSize]),r("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:i.canvas,"data-testid":"ships-canvas"})}const Mt=N({canvas:{position:"absolute",zIndex:4,pointerEvents:"none",border:"5px solid transparent",boxSizing:"border-box"}});function Pt(t){const e=f.exports.useRef(null),i=Mt();return f.exports.useEffect(()=>{te(e,t.uiScale,s=>{s.strokeStyle="black";for(const a of t.markers){s.fillStyle=a.type===B.Hit?"red":"white",s.beginPath();const n=C(X(a,t.gridSize),T(t.gridDimensions,.5));s.arc(n.x,n.y,F(t.gridSize)*.4,0,Math.PI*2),s.stroke(),s.fill()}})},[t.markers,e,t.uiScale,t.gridDimensions,t.gridSize]),r("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:i.canvas,"data-testid":"marker-canvas"})}const Tt=N({canvas:{position:"absolute",zIndex:2,border:"5px solid transparent",boxSizing:"border-box"}});function It(t){const e=f.exports.useRef(null),[i,s]=f.exports.useState(null),[a,n]=f.exports.useState(void 0),o=Tt();f.exports.useEffect(()=>{te(e,t.uiScale,u=>{const h=(S,p)=>{const L=Te(S,t.gridSize);u.fillStyle=p,u.beginPath(),Q(u,C(L[5],T(t.gridDimensions,.5)));for(const D of L)ee(u,C(D,T(t.gridDimensions,.5)));u.fill()};if(t.overlayStyle&&(e==null?void 0:e.current)&&(u.fillStyle=t.overlayStyle,u.fillRect(0,0,999999,999999)),i&&a&&h(i,a),t.highlightTiles)for(const S of t.highlightTiles)h(S,S.style)})},[e,t.highlightTiles,i,a,t.uiScale,t.gridDimensions,t.overlayStyle,t.gridSize]);const l=u=>{const h=u.target.getBoundingClientRect(),S=C(T({x:u.clientX,y:u.clientY},1/t.uiScale),T(t.gridDimensions,-.5),T(h,-1/t.uiScale));return Je(S,t.gridSize)},d=u=>{const h=l(u);P(h,t.gridSize)&&t.onSelectTile&&t.onSelectTile(h)},c=u=>{const h=l(u);s(P(h,t.gridSize)?h:null),n(t.mouseHighlightStyle?t.mouseHighlightStyle(h):void 0)},m=()=>{s(null)};return r("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:o.canvas,onClick:d,onMouseMove:c,onMouseLeave:m,"data-testid":"interaction-canvas"})}const Bt=N({board:{position:"relative",width:"100%",maxHeight:"100%",aspectRatio:.86,overflow:"hidden","@media (max-width: 640px)":{maxWidth:"100%",height:"100%"},gridArea:t=>t.gridArea}});function ye(t){var o,l;const e=f.exports.useRef(null),[i,s]=f.exports.useState(0),a=Bt(t);f.exports.useEffect(()=>{const d=()=>{var c,m;s(Math.min((((c=e==null?void 0:e.current)==null?void 0:c.clientWidth)||0)/420,(((m=e==null?void 0:e.current)==null?void 0:m.clientHeight)||0)/500))};return window.addEventListener("resize",d),d(),()=>{window.removeEventListener("resize",d)}},[e]);const n=Ze(t.gridSize);return g("div",{className:a.board,ref:e,children:[r(wt,{gridSize:t.gridSize,uiScale:i,gridDimensions:n}),(!!((o=t.highlightTiles)==null?void 0:o.length)||t.onSelectTile||t.mouseHighlightStyle)&&r(It,{gridSize:t.gridSize,onSelectTile:t.onSelectTile,highlightTiles:t.highlightTiles,mouseHighlightStyle:t.mouseHighlightStyle,uiScale:i,gridDimensions:n,overlayStyle:t.overlayStyle}),!!(t.ships||t.mines)&&r(Nt,{ships:t.ships||[],mines:t.mines||[],uiScale:i,gridDimensions:n,gridSize:t.gridSize}),!!((l=t.markers)==null?void 0:l.length)&&r(Pt,{markers:t.markers,uiScale:i,gridDimensions:n,gridSize:t.gridSize})]})}const he=640,Ft=N({container:{display:"inline-block",[`@media (max-width: ${he}px)`]:{width:"100%"}},panel:{margin:0,padding:0,listStyleType:"none",width:"100%"},shipList:{display:"grid",gridTemplateRows:"repeat(6, 1fr)",[`@media (max-width: ${he}px)`]:{gridTemplateRows:"repeat(2, 1fr)",gridTemplateColumns:"repeat(3, 1fr)"}},ship:{border:"2px solid black",background:"transparent",color:v,cursor:"pointer",textAlign:"left",boxSizing:"border-box",margin:{bottom:5},padding:{left:10,right:10,top:5,bottom:5},"@media (max-width: 560px)":{padding:{left:4,right:4,top:2,bottom:2}},"& div":{fontSize:"1.5rem","@media (max-width: 560px)":{fontSize:"1.1rem"}},"& span":{fontSize:"1rem",display:"inline-block","@media (max-width: 560px)":{fontSize:"0.8rem"}}},selectedShip:{backgroundColor:"#0050d4"},mines:{color:v,fontSize:"1.5rem",fontFamily:"sans-serif"},placedShip:{borderColor:v},actionContainer:{display:"flex",justifyContent:"space-between"},actionButton:x(b({},K),{[`@media (max-width: ${he}px)`]:{alignSelf:"stretch",fontSize:"1rem"}})});function Ht(t){const e=Ft();return g("div",{className:e.container,children:[t.mines===void 0?r("div",{className:e.shipList,children:t.ships.map(i=>g("button",{onClick:()=>t.onSelected(i.id),className:`${e.ship} ${i.id===t.selectedId?e.selectedShip:""} ${t.placedIds.indexOf(i.id)===-1?"":e.placedShip}`,children:[r("div",{children:i.name}),g("span",{children:["Size: ",i.size]})]},i.id))}):g("p",{className:e.mines,children:[t.mines," Mine",t.mines===1?"":"s"," remaining"]}),g("div",{className:e.actionContainer,children:[t.mines===void 0&&r("button",{className:e.actionButton,onClick:t.onRotated,disabled:!t.canRotate,children:"Rotate"}),r("button",{className:e.actionButton,onClick:t.onConfirm,disabled:!t.placementValid,children:"Confirm"})]})]})}const Lt=N({wrapper:{display:"grid",gridTemplateColumns:"5fr 1fr",gridTemplateRows:"100%",width:"100%",height:"100%",columnGap:"10px","@media (max-width: 640px)":{gridTemplateColumns:"100%",gridTemplateRows:"5fr 1fr",rowGap:"10px"}}});function Ot(t){const[e,i]=f.exports.useState([]),[s,a]=f.exports.useState([]),[n,o]=f.exports.useState(void 0),[l,d]=f.exports.useState(void 0),[c,m]=f.exports.useState(0),u=Lt(),h=Object.values(e);(n==null?void 0:n.ship)&&h.push(n.ship);const S=!!(n==null?void 0:n.ship)&&Ie(n.ship,Object.values(e),t.gameSettings.gridSize),p=c===0?h.length===t.gameSettings.ships.length&&xe(h,t.gameSettings.gridSize):s.length===t.gameSettings.mines,L=S?"green":"red",D=l?[{x:l.x,y:l.y,style:L}]:[],V=c===1?t.gameSettings.mines-s.length:void 0,$=k=>{if(k!==(n==null?void 0:n.id)){const M=b({},e);(n==null?void 0:n.ship)&&(M[n.id]=n.ship),e[k]?(o({id:k,ship:e[k]}),d(e[k]),delete M[k]):(o({id:k,ship:void 0}),d(void 0)),i(M)}},ie=()=>{(n==null?void 0:n.ship)&&o({id:n.id,ship:x(b({},n.ship),{facing:(n.ship.facing+1)%6})})},ne=()=>{p&&(c===1||t.gameSettings.mines===0?t.onFleetPlaced({ships:h,mines:s}):(m(1),d(void 0)))},se=k=>{if(n){if(n.ship)o({id:n.id,ship:x(b({},n.ship),{x:k.x,y:k.y})});else{const M=t.gameSettings.ships.find(H=>H.id===n.id);M&&o({id:n.id,ship:{x:k.x,y:k.y,size:M.size,facing:be.positiveX,hits:0,name:M.name,definitionId:M.id}})}d(k)}},ae=k=>{if(!h.map(j).flat().some(H=>z(H,k))){const H=s.findIndex(O=>z(O,k));if(H===-1)s.length<t.gameSettings.mines&&a([...s,k]);else{const O=[...s];O.splice(H,1),a(O)}}},oe=k=>{c===0?se(k):c===1&&ae(k)},re=()=>(n==null?void 0:n.id)||c===1?"orange":void 0;return g("div",{className:u.wrapper,children:[r(ye,{gridSize:t.gameSettings.gridSize,ships:h,mines:s,onSelectTile:oe,highlightTiles:D,mouseHighlightStyle:re}),r(Ht,{ships:t.gameSettings.ships,mines:V,placedIds:Object.keys(e).map(Number),selectedId:n==null?void 0:n.id,placementValid:p,canRotate:!!n,onSelected:$,onRotated:ie,onConfirm:ne})]})}const Et=N({statusPanel:{position:"relative",padding:{top:10,left:10,right:10,bottom:60},boxSizing:"border-box",minHeight:90,width:"100%",maxWidth:200,gridArea:"panel","@media (max-width: 640px)":{padding:0},display:"grid",gridTemplateColumns:"100%",gridTemplateRows:"repeat(7, 1fr)"},info:{fontFamily:q,color:v,fontSize:"2rem",margin:0,"@media (max-width: 640px)":{fontSize:"1rem"}},enemyShipHeader:{fontFamily:q,color:v,fontSize:"1.6rem",margin:{top:10,bottom:0},"@media (max-width: 640px)":{fontSize:"0.8rem"}},enemyShips:{display:"grid",gridTemplateColumns:"100%",gridTemplateRows:"repeat(6, 1fr)","@media (max-width: 640px)":{gridTemplateColumns:"1fr 1fr",gridTemplateRows:"repeat(3, 1fr)"}},enemyShip:{border:"2px solid black",color:v,fontFamily:"sans-serif",fontSize:"1.2rem",position:"relative",padding:4,margin:{top:5},"@media (max-width: 640px)":{fontSize:"0.6rem",padding:2}},enemyShipSunk:{border:"2px solid red","&:after":{width:"100%",height:"100%",display:"inline-block",position:"absolute",top:0,left:0,content:'""',background:"linear-gradient(10deg, transparent 47%, red 47%, red 53%, transparent 53%), linear-gradient(170deg, transparent 47%, red 47%, red 53%, transparent 53%)"}},fire:{border:"2px solid #ccc",cursor:"pointer",color:"white",fontSize:"1.5rem",textShadow:"1px 1px 0 black",background:"radial-gradient(#ff8000, #ff0000)",textTransform:"uppercase","&:hover":{background:"radial-gradient(#ffa447, #ff4747)"},"&:disabled":{color:"#aaa",background:"#777",cursor:"default"}},shotsRemaining:{color:v,fontFamily:"sans-serif",fontSize:"1.2rem","@media (max-width: 640px)":{fontSize:"0.6rem"}}});function Rt(t){var i;const e=Et();return g("div",{className:e.statusPanel,children:[t.statusMessage&&r("p",{className:e.info,children:t.statusMessage}),((i=t.ships)==null?void 0:i.length)&&g(I,{children:[r("p",{className:e.enemyShipHeader,children:"Enemy Ships"}),g("div",{className:e.enemyShips,children:[t.ships.map(s=>g("div",{className:`${e.enemyShip} ${t.sunkShipIds&&t.sunkShipIds.indexOf(s.id)!==-1?e.enemyShipSunk:""}`,children:[s.name," (",s.size,")"]},s.id)),t.fireButtonVisible&&g(I,{children:[r("button",{className:e.fire,onClick:t.onFireClick,disabled:!t.fireButtonEnabled,children:"Fire"}),!!t.shotsRemaining&&g("p",{className:e.shotsRemaining,children:[t.shotsRemaining," shot",t.shotsRemaining===1?"":"s"," remaining"]})]})]})]})]})}const Dt=N({wrapper:{display:"grid",gridTemplateRows:"100%",gridTemplateColumns:"4fr 4fr 1fr",width:"100%",height:"100%",gridTemplateAreas:'"friend enemy panel"',"@media (max-width: 640px)":{gridTemplateColumns:"8fr 1fr",gridTemplateRows:"4fr 3fr",gridTemplateAreas:'"enemy enemy" "friend panel"'}},menuButton:{position:"absolute",left:10,top:10,zIndex:10,border:"2px solid white",background:"#333",color:v,fontSize:"1rem"}});function $t(t){const[e,i]=f.exports.useState(void 0),[s,a]=f.exports.useState(0),[n,o]=f.exports.useState([]),[l,d]=f.exports.useState(!1),[c,m]=f.exports.useState([]),[u,h]=f.exports.useState([]),S=Dt(),p=t.gameInterface.getSettings();f.exports.useEffect(()=>{const y=(w,A)=>{var Ce;if(i(x(b({},w),{ownMarkers:w.ownMarkers.slice(0),opponentMarkers:w.opponentMarkers.slice(0),ownShips:w.ownShips.slice(0),isOwnTurn:w.isOwnTurn,sunkEnemies:w.sunkEnemies.slice(0)})),A)m([...w.opponentMarkers]);else{const we=w.opponentMarkers.length-c.length;we>0&&(h(w.opponentMarkers.slice(-we)),m([...w.opponentMarkers]))}let Z=0;w.gameWon||w.gameLost?Z=3:((Ce=w.ownShips)==null?void 0:Ce.length)&&(w.opponentShipsPlaced?Z=2:Z=1),a(Z)};return t.gameInterface.onStateChange(y),()=>{t.gameInterface.offStateChange(y)}},[t.gameInterface,e,c.length]);const L=y=>{t.gameInterface.setFleet(y)},D=y=>!(e==null?void 0:e.ownMarkers.some(w=>z(y,w))),V=(e==null?void 0:e.isOwnTurn)&&s===2,$=e?ke(p,e):0,ie=y=>{if(V&&D(y)){const w=n.findIndex(A=>z(A,y));if(w===-1)$===1?o([y]):n.length<$&&o([...n,y]);else{const A=[...n];A.splice(w,1),o(A)}}},ne=y=>V&&D(y)?"orange":void 0,se=()=>{n.length===$&&n.every(y=>D(y))&&(t.gameInterface.fireShots(n),o([]))},ae=()=>{d(!0)},oe=()=>{t.gameInterface.leaveGame(),t.onExit()},re=()=>{d(!1)},k=u.map(y=>({x:y.x,y:y.y,style:"orange"}));let M;s===2?M=(e==null?void 0:e.isOwnTurn)?"Take your shot":"Enemy's turn":s===3?(t.gameInterface.leaveGame(),(e==null?void 0:e.opponentLeft)?M="Your opponent left":M=`You have ${(e==null?void 0:e.gameWon)?"Won":"Lost"}`):s===1&&(M="Enemy placing ships");let H;(e==null?void 0:e.gameWon)?H=e.ownMarkers.filter(y=>y.type===B.Hit).map(y=>({x:y.x,y:y.y,style:"red"})):H=n.map(y=>({x:y.x,y:y.y,style:"red"}));let O;(e==null?void 0:e.gameWon)?O="rgba(0, 255, 0, 0.3)":(e==null?void 0:e.gameLost)&&(O="rgba(255, 0, 0, 0.3)");const $e=V&&(p.shots>1||p.shotPerShip)?$-n.length:void 0;return g(I,{children:[l&&r(Re,{onOk:oe,onClose:re,okButton:!0,cancelButton:!0,children:"Are you sure you want to end the game?"}),r("button",{className:S.menuButton,onClick:ae,children:"Menu"}),s===0?r(Ot,{gameSettings:p,onFleetPlaced:L}):g("div",{className:S.wrapper,children:[r(ye,{gridSize:p.gridSize,ships:e==null?void 0:e.ownShips,mines:e==null?void 0:e.ownMines,markers:e==null?void 0:e.opponentMarkers,highlightTiles:k,gridArea:"friend",overlayStyle:O}),r(ye,{gridSize:p.gridSize,ships:e==null?void 0:e.opponentShips,mines:e==null?void 0:e.opponentMines,markers:e==null?void 0:e.ownMarkers,onSelectTile:ie,highlightTiles:H,mouseHighlightStyle:ne,gridArea:"enemy",overlayStyle:O}),r(Rt,{statusMessage:M,ships:s===1?void 0:p.ships,sunkShipIds:e==null?void 0:e.sunkEnemies,fireButtonVisible:s===2,fireButtonEnabled:!!(n.length===$&&(e==null?void 0:e.isOwnTurn)),shotsRemaining:$e,onFireClick:se})]})]})}class Gt{constructor(e,i){E(this,"stateSubscriptions");this.socket=e,this.gameSettings=i,this.stateSubscriptions=[],this.socket.on("update-state",s=>{this.stateSubscriptions.forEach(a=>a(s,!1))})}onStateChange(e){this.stateSubscriptions.push(e)}offStateChange(e){const i=this.stateSubscriptions.indexOf(e);i>=0&&this.stateSubscriptions.splice(i,1)}setFleet(e){this.socket.emit("set-fleet",e)}fireShots(e){this.socket.emit("fire-shots",e)}leaveGame(){this.socket.emit("leave-game")}getSettings(){return this.gameSettings}}const At=N({container:{backgroundColor:"#022866",width:"100%",height:"100%",overflow:"auto"}});function Wt(){const[t,e]=f.exports.useState(null),[i,s]=f.exports.useState(!1),[a,n]=f.exports.useState(void 0),o=At();f.exports.useEffect(()=>{const c=Xe();n(c),c.on("connect",()=>{s(!0)})},[]),f.exports.useEffect(()=>{const c=st();c&&e(c)},[]);const l=c=>{e(c)};f.exports.useEffect(()=>(a==null||a.on("join-game",c=>{l(new Gt(a,c))}),()=>{a==null||a.removeAllListeners("join-game")}),[a]);const d=()=>{e(null)};return r("div",{className:o.container,children:t?r($t,{gameInterface:t,onExit:d}):r(vt,{onNewGame:l,socket:a,isConnected:i})})}Me.setAppElement("#root");Ye.render(r(qe.StrictMode,{children:r(Wt,{})}),document.getElementById("root"));
