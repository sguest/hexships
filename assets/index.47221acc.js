var Pe=Object.defineProperty,Ne=Object.defineProperties;var He=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var se=(t,e,i)=>e in t?Pe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,P=(t,e)=>{for(var i in e||(e={}))Be.call(e,i)&&se(t,i,e[i]);if(ue)for(var i of ue(e))Le.call(e,i)&&se(t,i,e[i]);return t},B=(t,e)=>Ne(t,He(e));var O=(t,e,i)=>(se(t,typeof e!="symbol"?e+"":e,i),i);import{c as M,j as S,R as Se,a as l,r as g,F as G,l as Oe,b as Ee,d as Re}from"./vendor.dc3d6da2.js";const Fe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}};Fe();var le=(t=>(t[t.positiveX=0]="positiveX",t[t.positiveY=1]="positiveY",t[t.positiveZ=2]="positiveZ",t[t.negativeX=3]="negativeX",t[t.negativeY=4]="negativeY",t[t.negativeZ=5]="negativeZ",t))(le||{});const Ie={[0]:{x:1,y:0},[1]:{x:0,y:1},[2]:{x:-1,y:1},[3]:{x:-1,y:0},[4]:{x:0,y:-1},[5]:{x:1,y:-1}};function A(t){return Ie[t]}function ye(){return[0,1,2,3,4,5]}function v(...t){const e={x:0,y:0};for(const i of t)e.x+=i.x,e.y+=i.y;return e}function E(t,e){return{x:t.x*e,y:t.y*e}}function k(t,e){return t.x===e.x&&t.y===e.y}function _(t,e){t.moveTo(e.x,e.y)}function Q(t,e){t.lineTo(e.x,e.y)}const ce=Math.sqrt(3),F=20;function Y(t){return{x:1.5*t.x*F,y:(t.y+.5*t.x)*F*ce}}function pe(t){const e=Y(t);return[...Array(6).keys()].map(i=>{const n=Math.PI/3*i;return{x:e.x+F*Math.cos(n),y:e.y+F*Math.sin(n)}})}function De(t){return{x:t*3*F,y:t*2*F*ce}}function Ge(t){const e=-t.x-t.y;let i=Math.round(t.x),n=Math.round(t.y);const o=Math.round(e),s=Math.abs(i-t.x),a=Math.abs(n-t.y),r=Math.abs(o-e);return s>a&&s>r?i=-n-o:a>r&&(n=-i-o),{x:i,y:n}}function $e(t){return Ge({x:t.x*2/3/F,y:(t.x*-1/3+t.y*ce/3)/F})}function N(t,e){const i=-t.x-t.y;return t.x>-e&&t.x<e&&t.y>-e&&t.y<e&&i>-e&&i<e}function Ae(t){const e=[];for(let i=-t+1;i<t;i++)for(let n=-t+1;n<t;n++)N({x:i,y:n},t)&&e.push({x:i,y:n});return e}function We(t,e){return ye().map(i=>{const n=A(i);return v(t,n)}).filter(i=>N(i,e))}function V(t){const e=A(t.facing);let i={x:t.x,y:t.y};const n=[{x:t.x,y:t.y}];for(let o=1;o<t.size;o++)i=v(i,e),n.push(i);return n}function xe(t,e,i){const n=V(t),o=e.map(s=>V(s)).flat();for(const s of n){if(!N(s,i))return!1;for(const a of o)if(k(s,a))return!1}return!0}function de(t,e){for(let i=0;i<t.length;i++)if(!xe(t[i],t.slice(i+1),e))return!1;return!0}var R=(t=>(t[t.Hit=0]="Hit",t[t.Miss=1]="Miss",t))(R||{});function be(t){return t.filter(e=>e.hits===e.size)}function he(t,e){return t.shotPerShip?e.ownShips.length-be(e.ownShips).length:t.shots}class je{constructor(e,i){O(this,"players");O(this,"activePlayerId");this.gameSettings=e,this.subscriber=i,this.players=[{ships:[],mines:[],markers:[],active:!0},{ships:[],mines:[],markers:[],active:!0}],this.activePlayerId=0}getLocalState(e){const i=+!e,n=this.playerLost(i),o=this.playerLost(e),s=o||n;return{ownShips:this.players[e].ships,ownMarkers:this.players[e].markers,ownMines:this.players[e].mines,opponentShips:s?this.players[i].ships:void 0,opponentMarkers:this.players[i].markers,opponentMines:this.players[i].mines.filter(a=>s||this.players[e].markers.some(r=>k(a,r))),isOwnTurn:e===this.activePlayerId&&!!this.players[e].ships.length,sunkEnemies:be(this.players[i].ships).map(a=>a.definitionId),gameWon:n,gameLost:o,opponentShipsPlaced:!!this.players[i].ships.length,opponentLeft:!this.players[i].active}}playerLost(e){const i=this.players[e];return!i.active||!!i.ships.length&&i.ships.every(n=>n.hits===n.size)}validateShipPlacement(e){const i=this.gameSettings.ships.slice(0),n=[];for(const o of e){const s=i.findIndex(r=>r.id===o.definitionId);if(s===-1)return[];const a=i[s];n.push({x:o.x,y:o.y,size:a.size,facing:o.facing,hits:0,name:a.name,definitionId:o.definitionId}),i.splice(s,1)}return i.length?[]:de(n,this.gameSettings.gridSize)?n:[]}validateMinePlacement(e,i){if(e.length!==this.gameSettings.mines)return!1;const n=i.map(o=>V(o)).flat();for(const o of e)if(n.some(s=>k(s,o))||e.some(s=>s!==o&&k(o,s))||!N(o,this.gameSettings.gridSize))return!1;return!0}setFleet(e,i){if(!this.players[e])return;const n=this.validateShipPlacement(i.ships);n.length&&this.validateMinePlacement(i.mines,n)?(this.players[e].ships=n,this.players[e].mines=i.mines.slice(),this.allShipsPlaced()?this.broadcastState():this.sendState(e)):this.sendState(e)}tryHit(e,i){for(const n of e)for(const o of V(n))if(k(o,i))return n.hits++,!0;return!1}fireShots(e,i){const n=this.players[e],o=this.getLocalState(e),s=+!e;if(this.activePlayerId===e&&!this.playerLost(e)&&!this.playerLost(s)&&this.allShipsPlaced()&&i.length===he(this.gameSettings,o)&&i.every(r=>!!r&&N(r,this.gameSettings.gridSize)&&!n.markers.some(c=>k(c,r))&&!i.some(c=>c!==r&&k(r,c)))){let r=!1;for(const c of i){const h=this.tryHit(this.players[s].ships,c);if(n.markers.push({x:c.x,y:c.y,type:h?R.Hit:R.Miss}),r=r||h,this.players[s].mines.some(m=>k(m,c)))for(const m of[...We(c,this.gameSettings.gridSize),c])this.players[s].markers.some(u=>k(u,m))||this.players[s].markers.push({x:m.x,y:m.y,type:this.tryHit(this.players[e].ships,m)?R.Hit:R.Miss})}(!this.gameSettings.streak||!r)&&(this.activePlayerId=s),this.broadcastState()}else this.sendState(e)}leaveGame(e){const i=+!e;!this.playerLost(e)&&!this.playerLost(i)&&(this.players[e].active=!1,this.broadcastState())}sendState(e){this.subscriber(e,this.getLocalState(e))}broadcastState(){for(let e=0;e<this.players.length;e++)this.sendState(e)}allShipsPlaced(){return this.players.every(e=>e.ships.length)}}function j(t,e){return Math.floor(Math.random()*(e-t+1))+t}function Ve(t){const e=Object.keys(t).map(o=>Number.parseInt(o)).filter(o=>!Number.isNaN(o)),i=Math.floor(Math.random()*e.length);return e[i]}class Ye{constructor(e){O(this,"ownShots",[]);O(this,"ownShotCount",0);O(this,"priorityHits",[]);O(this,"trackedHits",[]);O(this,"sunkShips",[]);this.gameSettings=e}generateFleet(){const e=[],i=-this.gameSettings.gridSize,n=-this.gameSettings.gridSize,o=this.gameSettings.gridSize,s=this.gameSettings.gridSize;for(const c of this.gameSettings.ships){let h;do h={size:c.size,name:c.name,x:j(i,o),y:j(n,s),facing:Ve(le),hits:0,definitionId:c.id};while(!de([...e,h],this.gameSettings.gridSize));e.push(h)}const a=[],r=e.map(V).flat();for(let c=0;c<this.gameSettings.mines;c++){let h;do h={x:j(i,o),y:j(n,s)};while(!N(h,this.gameSettings.gridSize)||a.some(m=>k(m,h)||r.some(u=>k(u,h))));a.push(h)}return{ships:e,mines:a}}updateState(e){var i,n;if(!!((i=e.ownMarkers)==null?void 0:i.length))for(;e.ownMarkers.length>this.ownShotCount;){const o=e.ownMarkers[this.ownShotCount];if(this.ownShots[o.x]=this.ownShots[o.x]||[],this.ownShots[o.x][o.y]===void 0&&(this.ownShots[o.x][o.y]=o.type,o.type===R.Hit)){if(e.sunkEnemies.length===this.sunkShips.length)this.priorityHits.push(o),this.trackedHits.push(o);else for(const s of e.sunkEnemies)if(this.sunkShips.indexOf(s)===-1){this.sunkShips.push(s);const a=(n=this.gameSettings.ships.find(r=>r.id===s))==null?void 0:n.size;if(a){let r=!1;for(let c=0;c<6;c++)if(!r){const h=A(c);let m=o;const u=[m];for(let d=0;d<a;d++)m=v(m,h),this.trackedHits.find(x=>k(x,m))&&u.push(m);if(u.length===a){r=!0;for(const d of u){let y=this.trackedHits.findIndex(x=>k(x,d));y!==-1&&this.trackedHits.splice(y,1),y=this.priorityHits.findIndex(x=>k(x,d)),y!==-1&&this.priorityHits.splice(y,1)}}}}}}this.ownShotCount++}}getShots(e){const i=[];for(;this.priorityHits.length;){const a=this.priorityHits[0],r=ye();for(;r.length;){const h=r.splice(j(0,r.length-1),1)[0];let m=A(h);const u=v(a,m);let d=a;if(this.trackedHits.find(y=>k(y,u))){for(;this.getOwnShot(d)===R.Hit&&N(d,this.gameSettings.gridSize);)d=v(d,m);for(;this.getOwnShot(d)===void 0&&N(d,this.gameSettings.gridSize);)i.push(d),d=v(d,m);for(d=a,m=A((h+3)%6);this.getOwnShot(d)===R.Hit&&N(d,this.gameSettings.gridSize);)d=v(d,m);for(;this.getOwnShot(d)===void 0&&N(d,this.gameSettings.gridSize);)i.push(d),d=v(d,m)}}if(i.length>=e)return i.slice(0,e);const c=[];for(let h=0;h<6;h++){const m=A(h),u=v(a,m);this.getOwnShot(u)===void 0&&N(u,this.gameSettings.gridSize)&&c.push(u)}for(;c.length;)i.push(c.splice(j(0,c.length-1),1)[0]);if(i.length>=e)return i.slice(0,e);this.priorityHits.splice(0,1)}const n=this.gameSettings.ships.filter(a=>!this.sunkShips.some(r=>a.id===r)),o=Math.min(...n.map(a=>a.size)),s=[];for(let a=-this.gameSettings.gridSize;a<=this.gameSettings.gridSize;a++)for(let r=-this.gameSettings.gridSize;r<=this.gameSettings.gridSize;r++){const c={x:a,y:r};if(N(c,this.gameSettings.gridSize)&&this.getOwnShot(c)===void 0)for(let h=0;h<3;h++){const m=A(h);let u=!0;const d=[c];let y=c;for(let x=1;x<o;x++){y=v(y,m);const L=this.getOwnShot(y);!N(y,this.gameSettings.gridSize)||L===R.Miss?u=!1:L===void 0&&d.push(y)}u&&s.push(...d)}}for(;i.length<e;)i.push(s.splice(j(0,s.length-1),1)[0]);return i}getOwnShot(e){return this.ownShots[e.x]&&this.ownShots[e.x][e.y]}}const oe=0,ge=1;class Xe{constructor(e){O(this,"stateSubscriptions");O(this,"gameManager");O(this,"aiPlayer");this.gameSettings=e,this.stateSubscriptions=[],this.gameManager=new je(e,(i,n)=>this.sendState(i,n)),this.aiPlayer=new Ye(e)}onStateChange(e){this.stateSubscriptions.push(e)}offStateChange(e){const i=this.stateSubscriptions.indexOf(e);i>=0&&this.stateSubscriptions.splice(i,1)}setFleet(e){this.gameManager.setFleet(oe,e),this.gameManager.setFleet(ge,this.aiPlayer.generateFleet())}fireShots(e){this.gameManager.fireShots(oe,e)}leaveGame(){}getSettings(){return this.gameSettings}sendState(e,i){e===oe?this.stateSubscriptions.forEach(n=>n(i)):(this.aiPlayer.updateState(i),i.isOwnTurn&&!i.gameLost&&!i.gameWon&&setTimeout(()=>{this.takeEnemyShot(i)},1e3))}takeEnemyShot(e){this.gameManager.fireShots(ge,this.aiPlayer.getShots(he(this.gameSettings,e)))}}class qe{constructor(e,i){O(this,"stateSubscriptions");this.socket=e,this.gameSettings=i,this.stateSubscriptions=[],this.socket.on("update-state",n=>{this.stateSubscriptions.forEach(o=>o(n))})}onStateChange(e){this.stateSubscriptions.push(e)}offStateChange(e){const i=this.stateSubscriptions.indexOf(e);i>=0&&this.stateSubscriptions.splice(i,1)}setFleet(e){this.socket.emit("set-fleet",e)}fireShots(e){this.socket.emit("fire-shots",e)}leaveGame(){this.socket.emit("leave-game")}getSettings(){return this.gameSettings}}const q={ships:[{id:1,size:2,name:"Patrol Boat"},{id:2,size:3,name:"Destroyer"},{id:3,size:3,name:"Submarine"},{id:4,size:4,name:"Battleship"},{id:5,size:5,name:"Aircraft Carrier"}],gridSize:7,streak:!1,shots:1,shotPerShip:!1,mines:0};var ve=(t=>(t[t.Basic=0]="Basic",t[t.Streak=1]="Streak",t[t.Barrage=2]="Barrage",t[t.Salvo=3]="Salvo",t[t.Minefield=4]="Minefield",t))(ve||{});const Ze={title:"Basic",id:0,description:"Basic rules with no modifications",settings:q},_e={title:"Streak",id:1,description:"Fire again after landing a hit",settings:B(P({},q),{streak:!0})},Qe={title:"Barrage",id:2,description:"Fire 4 shots each turn",settings:B(P({},q),{shots:4})},Ke={title:"Salvo",id:3,description:"Fire 1 shot for each surviving ship",settings:B(P({},q),{shotPerShip:!0})},Ue={title:"Minefield",id:4,description:"Place 5 mines that explode when hit by the enemy, damaging enemy ships",settings:B(P({},q),{mines:5})},ke={[0]:Ze,[1]:_e,[2]:Qe,[3]:Ke,[4]:Ue};function we(t){return ke[t]}function Ce(){return Object.values(ke)}const w="#ccc",X=["Big Shoulders Stencil Text","sans-serif"],K={fontSize:"1.2rem",border:"2px solid black",padding:{top:4,bottom:4,left:10,right:10},cursor:"pointer",color:w,backgroundColor:"#333","&:hover":{backgroundColor:"#555"},"&:disabled":{cursor:"default",backgroundColor:"#999"}},Je={border:`1px solid ${w}`,background:"transparent",color:w,padding:3,fontSize:"1rem","& option":{backgroundColor:"#022866"}},fe={fontSize:"1.6rem",border:"2px solid black",padding:{top:4,bottom:4,left:10,right:10},cursor:"pointer"},et=M({buttonContainer:{display:"flex",justifyContent:"space-between"},okButton:B(P({},fe),{"&:hover":{backgroundColor:"white"}}),cancelButton:B(P({},fe),{color:w,backgroundColor:"#333","&:hover":{backgroundColor:"#555"}})}),tt={content:{border:"3px solid #ccc",display:"inline-block",background:"#333",color:"white",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:20,fontSize:"1.5rem",fontFamily:"sans-serif",inset:"50% auto auto 50%"},overlay:{zIndex:999}};function ze(t){const e=et(),i=()=>{t.onClose(),t.onOk&&t.onOk()};return S(Se,{isOpen:!0,onRequestClose:t.onClose,style:tt,children:[l("p",{children:t.text}),S("div",{className:e.buttonContainer,children:[t.okButton&&l("button",{className:e.okButton,onClick:i,children:"OK"}),t.cancelButton&&l("button",{className:e.cancelButton,onClick:t.onClose,children:"Cancel"})]})]})}const it=M({tooltip:{fontSize:"1.5rem",cursor:"pointer",marginLeft:"20px",color:"#cfc",border:"none",background:"transparent"}});function Me(t){const e=it(),[i,n]=g.exports.useState(!1);return S(G,{children:[i&&l(ze,{text:t.text,okButton:!0,onClose:()=>n(!1)}),l("button",{className:e.tooltip,onClick:()=>n(!0),type:"button",children:"(?)"})]})}const nt=M({menu:{margin:0,padding:{left:20},listStyleType:"none"},menuButton:{background:"transparent",border:"none",fontFamily:X,color:w,fontSize:"1.5rem",cursor:"pointer","&:hover":{color:"#fff"}}});function st(t){const e=nt();return l("ul",{className:e.menu,children:t.items.filter(i=>i.condition===void 0||i.condition).map(i=>S("li",{children:[l("button",{className:e.menuButton,onClick:i.onClick,children:i.text}),i.tooltip&&l(Me,{text:i.tooltip})]},i.text))})}const ot=M({form:{padding:{left:20,right:20},maxWidth:400,"& label":{color:w,fontSize:"1.5rem",fontFamily:"sans-serif",display:"flex",justifyContent:"space-between",alignItems:"flex-start",margin:{bottom:15}},"& input, & select":B(P({},Je),{width:200,boxSizing:"border-box",maxWidth:"100%",flexShrink:0})},button:B(P({},K),{"&:first-of-type":{marginRight:20}})});function at(t){const e=ot(),[i,n]=g.exports.useState(ve.Basic),[o,s]=g.exports.useState(""),a=()=>{t.onCreated({name:o,mode:i})};return S("form",{className:e.form,children:[S("label",{children:["Game Name",l("input",{type:"text",value:o,onChange:r=>s(r.target.value)})]}),S("label",{children:["Game Mode",l(Me,{text:we(i).description}),l("select",{value:i,onChange:r=>n(r.target.value),"data-testid":"gamemode",children:Ce().map(r=>l("option",{value:r.id,children:r.title},r.id))})]}),l("button",{className:e.button,onClick:a,disabled:!o,type:"button",children:"Create"}),l("button",{className:e.button,onClick:()=>t.onCancel(),type:"button",children:"Cancel"})]})}const rt=M({button:K,noGamesMessage:{color:w,size:"2rem",fontFamily:"sans-serif",marginLeft:20},list:{listStyle:"none",padding:0,margin:20},game:{border:`1px solid ${w}`,padding:15,width:"100%",maxWidth:400,marginBottom:10},info:{margin:{top:0,bottom:5},color:w,fontSize:"1.2rem",fontFamily:"sans-serif"}});function lt(t){var i;const e=rt();return S(G,{children:[!t.games&&l("p",{className:e.noGamesMessage,children:"Loading game list..."}),!!t.games&&!t.games.length&&l("p",{className:e.noGamesMessage,children:"No games found"}),!!((i=t.games)==null?void 0:i.length)&&l("ul",{className:e.list,children:!!t.games&&t.games.map(n=>S("li",{className:e.game,children:[S("p",{className:e.info,children:["Name: ",n.definition.name]}),S("p",{className:e.info,children:["Mode: ",we(n.definition.mode).title]}),l("button",{className:e.button,onClick:()=>t.onSelected(n),children:"Join"})]},n.id))})]})}const ct=M({heading:{fontFamily:X,color:w,fontSize:"3rem",margin:0,padding:{top:10,bottom:10,left:20}},statusText:{fontFamily:X,color:w,fontSize:"1.5rem",padding:{left:20}},buttonStyle:B(P({},K),{margin:{left:20}})});function dt(t){const e=ct(),[i,n]=g.exports.useState(0),[o,s]=g.exports.useState(void 0),{socket:a,onNewGame:r}=t;g.exports.useEffect(()=>(a==null||a.on("join-game",f=>{r(new qe(a,f))}),()=>{a==null||a.removeAllListeners("join-game")}),[r,a]),g.exports.useEffect(()=>(a==null||a.on("add-lobby-game",f=>{o?o.findIndex(z=>z.id===f.id)===-1&&s([...o,f]):s([f])}),a==null||a.on("remove-lobby-game",f=>{if(o){const z=o.findIndex($=>$.id===f);if(z>=0){const $=o.slice();$.splice(z),s($)}}}),()=>{a==null||a.removeAllListeners("add-lobby-game"),a==null||a.removeAllListeners("remove-lobby-game")}),[a,o]);const c=f=>{n(4),a==null||a.emit("quick-connect",f)},h=()=>{a==null||a.emit("cancel-quick-connect"),n(3)},m=f=>{n(6),a==null||a.emit("add-lobby-game",f)},u=()=>{a==null||a.emit("remove-lobby-game"),n(2)},d=()=>{a==null||a.emit("enter-lobby",f=>{s(f)}),n(7)},y=f=>{a==null||a.emit("join-lobby-game",f.id)},x=f=>{t.onNewGame(new Xe(f))},L=f=>Ce().map(z=>({text:z.title,onClick:()=>f(z),tooltip:z.description}));let H=[];return i===0?H=[{text:"Versus AI",onClick:()=>n(1)},{text:"Multiplayer",onClick:()=>n(2),condition:t.isConnected}]:i===1?H=[...L(f=>x(f.settings)),{text:"Back",onClick:()=>n(0)}]:i===2?H=[{text:"Quick Match",onClick:()=>n(3)},{text:"Create Game",onClick:()=>n(5)},{text:"Find Game",onClick:d},{text:"Back",onClick:()=>n(0)}]:i===3&&(H=[...L(f=>c(f.id)),{text:"Back",onClick:()=>n(2)}]),S(G,{children:[l("h1",{className:e.heading,children:"Hexships"}),!!H.length&&l(st,{items:H}),i===4&&S(G,{children:[l("p",{className:e.statusText,children:"Searching for opponent..."}),l("button",{className:e.buttonStyle,onClick:h,children:"Cancel"})]}),i===5&&l(at,{onCreated:m,onCancel:()=>n(2)}),i===6&&S(G,{children:[l("p",{className:e.statusText,children:"Waiting for opponent..."}),l("button",{className:e.buttonStyle,onClick:u,children:"Cancel"})]}),i===7&&S(G,{children:[l("button",{className:e.buttonStyle,onClick:()=>n(2),children:"Back"}),l(lt,{games:o,onSelected:f=>y(f)})]})]})}function U(t,e,i){const n=t.current;if(!n)return;const o=n.getContext("2d");!o||(o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,n.width,n.height),o.scale(e,e),i(o))}const ht=M({"@keyframes boardGradient":{from:{backgroundPosition:"0% 50%"},to:{backgroundPosition:"100% 50%"}},canvas:{animationName:"$boardGradient",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"ease",animationDirection:"alternate",position:"absolute",zIndex:1,pointerEvents:"none",background:"linear-gradient(80deg, #00545c 0%, #00405c 30%, #00545c 60%, #00405c 90%)",backgroundSize:"400% 400%",border:"5px solid #242f40",boxSizing:"border-box"}});function mt(t){const e=g.exports.useRef(null),i=ht();return g.exports.useEffect(()=>{U(e,t.uiScale,n=>{n.strokeStyle="black",n.beginPath();const o=Ae(t.gridSize);for(const s of o){const a=pe(s);_(n,v(a[5],E(t.gridDimensions,.5)));for(const r of a)Q(n,v(r,E(t.gridDimensions,.5)))}n.stroke()})},[t.gridSize,e,t.uiScale,t.gridDimensions]),l("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:i.canvas,"data-testid":"field-canvas"})}const ut=M({canvas:{position:"absolute",zIndex:3,pointerEvents:"none",border:"5px solid transparent",boxSizing:"border-box"}});function gt(t){const e=g.exports.useRef(null),i=ut();return g.exports.useEffect(()=>{U(e,t.uiScale,n=>{var o;n.strokeStyle="grey",n.lineWidth=F,n.lineCap="round",n.beginPath();for(const s of t.ships){const a=Y(s),r=A(s.facing),c=v(s,E(r,s.size-1)),h=Y(c);_(n,v(a,E(t.gridDimensions,.5))),Q(n,v(h,E(t.gridDimensions,.5)))}if(n.stroke(),(o=t.mines)==null?void 0:o.length){n.strokeStyle="black",n.fillStyle="black",n.lineWidth=1,n.lineCap="butt",n.beginPath();const s=16,a=Math.PI*2/s;for(const r of t.mines){const c=Y(r),h=[];for(let m=0;m<s;m++){const u=m*a,d=F*(m%2?.3:.8);h.push(v(c,{x:Math.cos(u)*d,y:Math.sin(u)*d},E(t.gridDimensions,.5)))}_(n,h[s-1]);for(const m of h)Q(n,m)}n.fill()}})},[t.ships,t.mines,e,t.uiScale,t.gridDimensions]),l("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:i.canvas,"data-testid":"ships-canvas"})}const ft=M({canvas:{position:"absolute",zIndex:4,pointerEvents:"none",border:"5px solid transparent",boxSizing:"border-box"}});function St(t){const e=g.exports.useRef(null),i=ft();return g.exports.useEffect(()=>{U(e,t.uiScale,n=>{n.strokeStyle="black";for(const o of t.markers){n.fillStyle=o.type===R.Hit?"red":"white",n.beginPath();const s=v(Y(o),E(t.gridDimensions,.5));n.arc(s.x,s.y,F*.4,0,Math.PI*2),n.stroke(),n.fill()}})},[t.markers,e,t.uiScale,t.gridDimensions]),l("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:i.canvas,"data-testid":"marker-canvas"})}const yt=M({canvas:{position:"absolute",zIndex:2,border:"5px solid transparent",boxSizing:"border-box"}});function pt(t){const e=g.exports.useRef(null),[i,n]=g.exports.useState(null),[o,s]=g.exports.useState(void 0),a=yt();g.exports.useEffect(()=>{U(e,t.uiScale,u=>{const d=(y,x)=>{const L=pe(y);u.fillStyle=x,u.beginPath(),_(u,v(L[5],E(t.gridDimensions,.5)));for(const H of L)Q(u,v(H,E(t.gridDimensions,.5)));u.fill()};if(t.overlayStyle&&(e==null?void 0:e.current)&&(u.fillStyle=t.overlayStyle,u.fillRect(0,0,999999,999999)),i&&o&&d(i,o),t.highlightTiles)for(const y of t.highlightTiles)d(y,y.style)})},[e,t.highlightTiles,i,o,t.uiScale,t.gridDimensions,t.overlayStyle]);const r=u=>{const d=u.target.getBoundingClientRect(),y=v(E({x:u.clientX,y:u.clientY},1/t.uiScale),E(t.gridDimensions,-.5),E(d,-1/t.uiScale));return $e(y)},c=u=>{const d=r(u);N(d,t.gridSize)&&t.onSelectTile&&t.onSelectTile(d)},h=u=>{const d=r(u);n(N(d,t.gridSize)?d:null),s(t.mouseHighlightStyle?t.mouseHighlightStyle(d):void 0)},m=()=>{n(null)};return l("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:a.canvas,onClick:c,onMouseMove:h,onMouseLeave:m,"data-testid":"interaction-canvas"})}const xt=M({board:{position:"relative",width:"100%",maxHeight:"100%",aspectRatio:.86,overflow:"hidden","@media (max-width: 640px)":{maxWidth:"100%",height:"100%"},gridArea:t=>t.gridArea}});function re(t){var a,r;const e=g.exports.useRef(null),[i,n]=g.exports.useState(0),o=xt(t);g.exports.useEffect(()=>{const c=()=>{var h,m;n(Math.min((((h=e==null?void 0:e.current)==null?void 0:h.clientWidth)||0)/420,(((m=e==null?void 0:e.current)==null?void 0:m.clientHeight)||0)/500))};return window.addEventListener("resize",c),c(),()=>{window.removeEventListener("resize",c)}},[e]);const s=De(t.gridSize);return S("div",{className:o.board,ref:e,children:[l(mt,{gridSize:t.gridSize,uiScale:i,gridDimensions:s}),(!!((a=t.highlightTiles)==null?void 0:a.length)||t.onSelectTile||t.mouseHighlightStyle)&&l(pt,{gridSize:t.gridSize,onSelectTile:t.onSelectTile,highlightTiles:t.highlightTiles,mouseHighlightStyle:t.mouseHighlightStyle,uiScale:i,gridDimensions:s,overlayStyle:t.overlayStyle}),!!(t.ships||t.mines)&&l(gt,{ships:t.ships||[],mines:t.mines||[],uiScale:i,gridDimensions:s}),!!((r=t.markers)==null?void 0:r.length)&&l(St,{markers:t.markers,uiScale:i,gridDimensions:s})]})}const ae=640,bt=M({container:{display:"inline-block",[`@media (max-width: ${ae}px)`]:{width:"100%"}},panel:{margin:0,padding:0,listStyleType:"none",width:"100%"},shipList:{display:"grid",gridTemplateRows:"repeat(6, 1fr)",[`@media (max-width: ${ae}px)`]:{gridTemplateRows:"repeat(2, 1fr)",gridTemplateColumns:"repeat(3, 1fr)"}},ship:{border:"2px solid black",background:"transparent",color:w,cursor:"pointer",textAlign:"left",boxSizing:"border-box",margin:{bottom:5},padding:{left:10,right:10,top:5,bottom:5},"@media (max-width: 560px)":{padding:{left:4,right:4,top:2,bottom:2}},"& div":{fontSize:"1.5rem","@media (max-width: 560px)":{fontSize:"1.1rem"}},"& span":{fontSize:"1rem",display:"inline-block","@media (max-width: 560px)":{fontSize:"0.8rem"}}},selectedShip:{backgroundColor:"#0050d4"},mines:{color:w,fontSize:"1.5rem",fontFamily:"sans-serif"},placedShip:{borderColor:w},actionContainer:{display:"flex",justifyContent:"space-between"},actionButton:B(P({},K),{[`@media (max-width: ${ae}px)`]:{alignSelf:"stretch",fontSize:"1rem"}})});function vt(t){const e=bt();return S("div",{className:e.container,children:[t.mines===void 0?l("div",{className:e.shipList,children:t.ships.map(i=>S("button",{onClick:()=>t.onSelected(i.id),className:`${e.ship} ${i.id===t.selectedId?e.selectedShip:""} ${t.placedIds.indexOf(i.id)===-1?"":e.placedShip}`,children:[l("div",{children:i.name}),S("span",{children:["Size: ",i.size]})]},i.id))}):S("p",{className:e.mines,children:[t.mines," Mine",t.mines===1?"":"s"," remaining"]}),S("div",{className:e.actionContainer,children:[t.mines===void 0&&l("button",{className:e.actionButton,onClick:t.onRotated,disabled:!t.canRotate,children:"Rotate"}),l("button",{className:e.actionButton,onClick:t.onConfirm,disabled:!t.placementValid,children:"Confirm"})]})]})}const kt=M({wrapper:{display:"grid",gridTemplateColumns:"5fr 1fr",gridTemplateRows:"100%",width:"100%",height:"100%",columnGap:"10px","@media (max-width: 640px)":{gridTemplateColumns:"100%",gridTemplateRows:"5fr 1fr",rowGap:"10px"}}});function wt(t){const[e,i]=g.exports.useState([]),[n,o]=g.exports.useState([]),[s,a]=g.exports.useState(void 0),[r,c]=g.exports.useState(void 0),[h,m]=g.exports.useState(0),u=kt(),d=Object.values(e);(s==null?void 0:s.ship)&&d.push(s.ship);const y=!!(s==null?void 0:s.ship)&&xe(s.ship,Object.values(e),t.gameSettings.gridSize),x=h===0?d.length===t.gameSettings.ships.length&&de(d,t.gameSettings.gridSize):n.length===t.gameSettings.mines,L=y?"green":"red",H=r?[{x:r.x,y:r.y,style:L}]:[],f=h===1?t.gameSettings.mines-n.length:void 0,z=b=>{if(b!==(s==null?void 0:s.id)){const T=P({},e);(s==null?void 0:s.ship)&&(T[s.id]=s.ship),e[b]?(a({id:b,ship:e[b]}),c(e[b]),delete T[b]):(a({id:b,ship:void 0}),c(void 0)),i(T)}},$=()=>{(s==null?void 0:s.ship)&&a({id:s.id,ship:B(P({},s.ship),{facing:(s.ship.facing+1)%6})})},J=()=>{x&&(h===1||t.gameSettings.mines===0?t.onFleetPlaced({ships:d,mines:n}):(m(1),c(void 0)))},ee=b=>{if(s){if(s.ship)a({id:s.id,ship:B(P({},s.ship),{x:b.x,y:b.y})});else{const T=t.gameSettings.ships.find(I=>I.id===s.id);T&&a({id:s.id,ship:{x:b.x,y:b.y,size:T.size,facing:le.positiveX,hits:0,name:T.name,definitionId:T.id}})}c(b)}},te=b=>{if(!d.map(V).flat().some(I=>k(I,b))){const I=n.findIndex(D=>k(D,b));if(I===-1)n.length<t.gameSettings.mines&&o([...n,b]);else{const D=[...n];D.splice(I,1),o(D)}}},ie=b=>{h===0?ee(b):h===1&&te(b)},ne=()=>(s==null?void 0:s.id)||h===1?"orange":void 0;return S("div",{className:u.wrapper,children:[l(re,{gridSize:t.gameSettings.gridSize,ships:d,mines:n,onSelectTile:ie,highlightTiles:H,mouseHighlightStyle:ne}),l(vt,{ships:t.gameSettings.ships,mines:f,placedIds:Object.keys(e).map(Number),selectedId:s==null?void 0:s.id,placementValid:x,canRotate:!!s,onSelected:z,onRotated:$,onConfirm:J})]})}const Ct=M({statusPanel:{position:"relative",padding:{top:10,left:10,right:10,bottom:60},boxSizing:"border-box",minHeight:90,width:"100%",maxWidth:200,gridArea:"panel","@media (max-width: 640px)":{padding:0},display:"grid",gridTemplateColumns:"100%",gridTemplateRows:"repeat(7, 1fr)"},info:{fontFamily:X,color:w,fontSize:"2rem",margin:0,"@media (max-width: 640px)":{fontSize:"1rem"}},enemyShipHeader:{fontFamily:X,color:w,fontSize:"1.6rem",margin:{top:10,bottom:0},"@media (max-width: 640px)":{fontSize:"0.8rem"}},enemyShips:{display:"grid",gridTemplateColumns:"100%",gridTemplateRows:"repeat(6, 1fr)","@media (max-width: 640px)":{gridTemplateColumns:"1fr 1fr",gridTemplateRows:"repeat(3, 1fr)"}},enemyShip:{border:"2px solid black",color:w,fontFamily:"sans-serif",fontSize:"1.2rem",position:"relative",padding:4,margin:{top:5},"@media (max-width: 640px)":{fontSize:"0.6rem",padding:2}},enemyShipSunk:{border:"2px solid red","&:after":{width:"100%",height:"100%",display:"inline-block",position:"absolute",top:0,left:0,content:'""',background:"linear-gradient(10deg, transparent 47%, red 47%, red 53%, transparent 53%), linear-gradient(170deg, transparent 47%, red 47%, red 53%, transparent 53%)"}},fire:{border:"2px solid #ccc",cursor:"pointer",color:"white",fontSize:"1.5rem",textShadow:"1px 1px 0 black",background:"radial-gradient(#ff8000, #ff0000)",textTransform:"uppercase","&:hover":{background:"radial-gradient(#ffa447, #ff4747)"},"&:disabled":{color:"#aaa",background:"#777",cursor:"default"}},shotsRemaining:{color:w,fontFamily:"sans-serif",fontSize:"1.2rem","@media (max-width: 640px)":{fontSize:"0.6rem"}}});function zt(t){var i;const e=Ct();return S("div",{className:e.statusPanel,children:[t.statusMessage&&l("p",{className:e.info,children:t.statusMessage}),((i=t.ships)==null?void 0:i.length)&&S(G,{children:[l("p",{className:e.enemyShipHeader,children:"Enemy Ships"}),S("div",{className:e.enemyShips,children:[t.ships.map(n=>S("div",{className:`${e.enemyShip} ${t.sunkShipIds&&t.sunkShipIds.indexOf(n.id)!==-1?e.enemyShipSunk:""}`,children:[n.name," (",n.size,")"]},n.id)),t.fireButtonVisible&&S(G,{children:[l("button",{className:e.fire,onClick:t.onFireClick,disabled:!t.fireButtonEnabled,children:"Fire"}),!!t.shotsRemaining&&S("p",{className:e.shotsRemaining,children:[t.shotsRemaining," shot",t.shotsRemaining===1?"":"s"," remaining"]})]})]})]})]})}const Mt=M({wrapper:{display:"grid",gridTemplateRows:"100%",gridTemplateColumns:"4fr 4fr 1fr",width:"100%",height:"100%",gridTemplateAreas:'"friend enemy panel"',"@media (max-width: 640px)":{gridTemplateColumns:"8fr 1fr",gridTemplateRows:"4fr 3fr",gridTemplateAreas:'"enemy enemy" "friend panel"'}},menuButton:{position:"absolute",left:10,top:10,zIndex:10,border:"2px solid white",background:"#333",color:w,fontSize:"1rem"}});function Tt(t){const[e,i]=g.exports.useState(void 0),[n,o]=g.exports.useState(0),[s,a]=g.exports.useState([]),[r,c]=g.exports.useState(!1),[h,m]=g.exports.useState([]),[u,d]=g.exports.useState([]),y=Mt(),x=t.gameInterface.getSettings();g.exports.useEffect(()=>{const p=C=>{var me;i(B(P({},C),{ownMarkers:C.ownMarkers.slice(0),opponentMarkers:C.opponentMarkers.slice(0),ownShips:C.ownShips.slice(0),isOwnTurn:C.isOwnTurn,sunkEnemies:C.sunkEnemies.slice(0)}));const W=C.opponentMarkers.length-h.length;W>0&&(d(C.opponentMarkers.slice(-W)),m([...C.opponentMarkers]));let Z=0;C.gameWon||C.gameLost?Z=3:((me=C.ownShips)==null?void 0:me.length)&&(C.opponentShipsPlaced?Z=2:Z=1),o(Z)};return t.gameInterface.onStateChange(p),()=>{t.gameInterface.offStateChange(p)}},[t.gameInterface,e,h.length]);const L=p=>{t.gameInterface.setFleet(p)},H=p=>!(e==null?void 0:e.ownMarkers.some(C=>k(p,C))),f=(e==null?void 0:e.isOwnTurn)&&n===2,z=e?he(x,e):0,$=p=>{if(f&&H(p)){const C=s.findIndex(W=>k(W,p));if(C===-1)z===1?a([p]):s.length<z&&a([...s,p]);else{const W=[...s];W.splice(C,1),a(W)}}},J=p=>f&&H(p)?"orange":void 0,ee=()=>{s.length===z&&s.every(p=>H(p))&&(t.gameInterface.fireShots(s),a([]))},te=()=>{c(!0)},ie=()=>{t.gameInterface.leaveGame(),t.onExit()},ne=()=>{c(!1)},b=u.map(p=>({x:p.x,y:p.y,style:"orange"}));let T;n===2?T=(e==null?void 0:e.isOwnTurn)?"Take your shot":"Enemy's turn":n===3?(e==null?void 0:e.opponentLeft)?T="Your opponent left":T=`You have ${(e==null?void 0:e.gameWon)?"Won":"Lost"}`:n===1&&(T="Enemy placing ships");let I;(e==null?void 0:e.gameWon)?I=e.ownMarkers.filter(p=>p.type===R.Hit).map(p=>({x:p.x,y:p.y,style:"red"})):I=s.map(p=>({x:p.x,y:p.y,style:"red"}));let D;(e==null?void 0:e.gameWon)?D="rgba(0, 255, 0, 0.3)":(e==null?void 0:e.gameLost)&&(D="rgba(255, 0, 0, 0.3)");const Te=f&&(x.shots>1||x.shotPerShip)?z-s.length:void 0;return S(G,{children:[r&&l(ze,{text:"Are you sure you want to end the game?",onOk:ie,onClose:ne,okButton:!0,cancelButton:!0}),l("button",{className:y.menuButton,onClick:te,children:"Menu"}),n===0?l(wt,{gameSettings:x,onFleetPlaced:L}):S("div",{className:y.wrapper,children:[l(re,{gridSize:x.gridSize,ships:e==null?void 0:e.ownShips,mines:e==null?void 0:e.ownMines,markers:e==null?void 0:e.opponentMarkers,highlightTiles:b,gridArea:"friend",overlayStyle:D}),l(re,{gridSize:x.gridSize,ships:e==null?void 0:e.opponentShips,mines:e==null?void 0:e.opponentMines,markers:e==null?void 0:e.ownMarkers,onSelectTile:$,highlightTiles:I,mouseHighlightStyle:J,gridArea:"enemy",overlayStyle:D}),l(zt,{statusMessage:T,ships:n===1?void 0:x.ships,sunkShipIds:e==null?void 0:e.sunkEnemies,fireButtonVisible:n===2,fireButtonEnabled:!!(s.length===z&&(e==null?void 0:e.isOwnTurn)),shotsRemaining:Te,onFireClick:ee})]})]})}const Pt=M({container:{backgroundColor:"#022866",width:"100%",height:"100%",overflow:"auto"}});function Nt(){const[t,e]=g.exports.useState(null),[i,n]=g.exports.useState(!1),[o,s]=g.exports.useState(void 0),a=Pt();g.exports.useEffect(()=>{const h=Oe();s(h),h.on("connect",()=>{n(!0)})},[]);const r=h=>{e(h)},c=()=>{e(null)};return l("div",{className:a.container,children:t?l(Tt,{gameInterface:t,onExit:c}):l(dt,{onNewGame:r,socket:o,isConnected:i})})}Se.setAppElement("#root");Ee.render(l(Re.StrictMode,{children:l(Nt,{})}),document.getElementById("root"));
