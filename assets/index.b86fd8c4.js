var oe=Object.defineProperty,ae=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var V=(i,e,t)=>e in i?oe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,I=(i,e)=>{for(var t in e||(e={}))ce.call(e,t)&&V(i,t,e[t]);if(Q)for(var t of Q(e))de.call(e,t)&&V(i,t,e[t]);return i},R=(i,e)=>ae(i,le(e));var M=(i,e,t)=>(V(i,typeof e!="symbol"?e+"":e,t),t);import{c as T,j as x,F as ne,a as l,r as m,R as he,b as ge}from"./vendor.900b0ea6.js";const ue=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}};ue();const me=T({heading:{fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"3rem",margin:0,padding:{top:10,bottom:10,left:20}},menu:{margin:0,padding:{left:20},listStyleType:"none"},menuButton:{background:"transparent",border:"none",fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"1.5rem",cursor:"pointer","&:hover":{color:"#fff"}}});function fe(i){const e=me();return x(ne,{children:[l("h1",{className:e.heading,children:"Hexships"}),l("ul",{className:e.menu,children:l("li",{children:l("button",{className:e.menuButton,onClick:i.onNewGame,children:"New Game"})})})]})}const q=Math.sqrt(3),C=20;function A(i){return{x:1.5*i.x*C,y:(i.y+.5*i.x)*C*q}}function se(i){const e=A(i);return[...Array(6).keys()].map(t=>{const n=Math.PI/3*t;return{x:e.x+C*Math.cos(n),y:e.y+C*Math.sin(n)}})}function Se(i){return{x:i*3*C,y:i*2*C*q}}function ye(i){const e=-i.x-i.y;let t=Math.round(i.x),n=Math.round(i.y);const s=Math.round(e),r=Math.abs(t-i.x),o=Math.abs(n-i.y),a=Math.abs(s-e);return r>o&&r>a?t=-n-s:o>a&&(n=-t-s),{x:t,y:n}}function pe(i){return ye({x:i.x*2/3/C,y:(i.x*-1/3+i.y*q/3)/C})}function v(i,e){const t=-i.x-i.y;return i.x>-e&&i.x<e&&i.y>-e&&i.y<e&&t>-e&&t<e}function xe(i){const e=[];for(let t=-i+1;t<i;t++)for(let n=-i+1;n<i;n++)v({x:t,y:n},i)&&e.push({x:t,y:n});return e}function p(...i){const e={x:0,y:0};for(const t of i)e.x+=t.x,e.y+=t.y;return e}function z(i,e){return{x:i.x*e,y:i.y*e}}function H(i,e){return i.x===e.x&&i.y===e.y}function _(i,e){i.moveTo(e.x,e.y)}function K(i,e){i.lineTo(e.x,e.y)}function F(i,e,t){const n=i.current;if(!n)return;const s=n.getContext("2d");!s||(s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,n.width,n.height),s.scale(e,e),t(s))}const be=T({"@keyframes boardGradient":{from:{backgroundPosition:"0% 50%"},to:{backgroundPosition:"100% 50%"}},canvas:{animationName:"$boardGradient",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"ease",animationDirection:"alternate",position:"absolute",zIndex:1,pointerEvents:"none",background:"linear-gradient(80deg, #00545c 0%, #00405c 30%, #00545c 60%, #00405c 90%)",backgroundSize:"400% 400%",border:"5px solid #242f40",boxSizing:"border-box"}});function ve(i){const e=m.exports.useRef(null),t=be();return m.exports.useEffect(()=>{F(e,i.uiScale,n=>{n.strokeStyle="black",n.beginPath();const s=xe(i.gridSize);for(const r of s){const o=se(r);_(n,p(o[5],z(i.gridDimensions,.5)));for(const a of o)K(n,p(a,z(i.gridDimensions,.5)))}n.stroke()})},[i.gridSize,e,i.uiScale,i.gridDimensions]),l("canvas",{ref:e,width:i.gridDimensions.x*i.uiScale,height:i.gridDimensions.y*i.uiScale,className:t.canvas})}var P=(i=>(i[i.positiveX=0]="positiveX",i[i.positiveY=1]="positiveY",i[i.positiveZ=2]="positiveZ",i[i.negativeX=3]="negativeX",i[i.negativeY=4]="negativeY",i[i.negativeZ=5]="negativeZ",i))(P||{});const ke={[0]:{x:1,y:0},[1]:{x:0,y:1},[2]:{x:-1,y:1},[3]:{x:-1,y:0},[4]:{x:0,y:-1},[5]:{x:1,y:-1}};function O(i){return ke[i]}const we=T({canvas:{position:"absolute",zIndex:3,pointerEvents:"none",border:"5px solid transparent",boxSizing:"border-box"}});function ze(i){const e=m.exports.useRef(null),t=we();return m.exports.useEffect(()=>{F(e,i.uiScale,n=>{n.strokeStyle="grey",n.lineWidth=C,n.lineCap="round",n.beginPath();for(const s of i.ships){const r=A(s),o=O(s.facing),a=p(s,z(o,s.size-1)),h=A(a);_(n,p(r,z(i.gridDimensions,.5))),K(n,p(h,z(i.gridDimensions,.5)))}n.stroke()})},[i.ships,e,i.uiScale,i.gridDimensions]),l("canvas",{ref:e,width:i.gridDimensions.x*i.uiScale,height:i.gridDimensions.y*i.uiScale,className:t.canvas})}var N=(i=>(i[i.Hit=0]="Hit",i[i.Miss=1]="Miss",i))(N||{});const Te=T({canvas:{position:"absolute",zIndex:4,pointerEvents:"none",border:"5px solid transparent",boxSizing:"border-box"}});function Me(i){const e=m.exports.useRef(null),t=Te();return m.exports.useEffect(()=>{F(e,i.uiScale,n=>{n.strokeStyle="black";for(const s of i.markers){n.fillStyle=s.type===N.Hit?"red":"white",n.beginPath();const r=p(A(s),z(i.gridDimensions,.5));n.arc(r.x,r.y,C*.4,0,Math.PI*2),n.stroke(),n.fill()}})},[i.markers,e,i.uiScale,i.gridDimensions]),l("canvas",{ref:e,width:i.gridDimensions.x*i.uiScale,height:i.gridDimensions.y*i.uiScale,className:t.canvas})}const Ce=T({canvas:{position:"absolute",zIndex:2,border:"5px solid transparent",boxSizing:"border-box"}});function Pe(i){const e=m.exports.useRef(null),[t,n]=m.exports.useState(null),[s,r]=m.exports.useState(void 0),o=Ce();m.exports.useEffect(()=>{F(e,i.uiScale,d=>{const u=(S,k)=>{const E=se(S);d.fillStyle=k,d.beginPath(),_(d,p(E[5],z(i.gridDimensions,.5)));for(const L of E)K(d,p(L,z(i.gridDimensions,.5)));d.fill()};if(i.overlayStyle&&(e==null?void 0:e.current)&&(d.fillStyle=i.overlayStyle,d.fillRect(0,0,e.current.width,e.current.height)),t&&s&&u(t,s),i.highlightTiles)for(const S of i.highlightTiles)u(S,S.style)})},[e,i.highlightTiles,t,s,i.uiScale,i.gridDimensions,i.overlayStyle]);const a=d=>{const u=d.target.getBoundingClientRect(),S=p(z({x:d.clientX,y:d.clientY},1/i.uiScale),z(i.gridDimensions,-.5),z(u,-1/i.uiScale));return pe(S)},h=d=>{const u=a(d);v(u,i.gridSize)&&i.onSelectTile&&i.onSelectTile(u)},g=d=>{const u=a(d);n(v(u,i.gridSize)?u:null),r(i.mouseHighlightStyle?i.mouseHighlightStyle(u):void 0)},c=()=>{n(null)};return l("canvas",{ref:e,width:i.gridDimensions.x*i.uiScale,height:i.gridDimensions.y*i.uiScale,className:o.canvas,onClick:h,onMouseMove:g,onMouseLeave:c})}const Ne=T({board:{position:"relative",width:"100%",maxHeight:"100%",aspectRatio:.86,overflow:"hidden","@media (max-width: 640px)":{maxWidth:"100%",height:"100%"},gridArea:i=>i.gridArea}});function j(i){var o,a;const e=m.exports.useRef(null),[t,n]=m.exports.useState(0),s=Ne(i);m.exports.useEffect(()=>{const h=()=>{var g,c;n(Math.min((((g=e==null?void 0:e.current)==null?void 0:g.clientWidth)||0)/420,(((c=e==null?void 0:e.current)==null?void 0:c.clientHeight)||0)/500))};return window.addEventListener("resize",h),h(),()=>{window.removeEventListener("resize",h)}},[e]);const r=Se(i.gridSize);return x("div",{className:s.board,ref:e,children:[l(ve,{gridSize:i.gridSize,uiScale:t,gridDimensions:r}),(!!((o=i.highlightTiles)==null?void 0:o.length)||i.onSelectTile||i.mouseHighlightStyle)&&l(Pe,{gridSize:i.gridSize,onSelectTile:i.onSelectTile,highlightTiles:i.highlightTiles,mouseHighlightStyle:i.mouseHighlightStyle,uiScale:t,gridDimensions:r,overlayStyle:i.overlayStyle}),i.ships&&l(ze,{ships:i.ships,uiScale:t,gridDimensions:r}),!!((a=i.markers)==null?void 0:a.length)&&l(Me,{markers:i.markers,uiScale:t,gridDimensions:r})]})}function Z(i){const e=O(i.facing);let t={x:i.x,y:i.y};const n=[{x:i.x,y:i.y}];for(let s=1;s<i.size;s++)t=p(t,e),n.push(t);return n}function re(i,e,t){const n=Z(i),s=e.map(r=>Z(r)).flat();for(const r of n){if(!v(r,t))return!1;for(const o of s)if(H(r,o))return!1}return!0}function U(i,e){for(let t=0;t<i.length;t++)if(!re(i[t],i.slice(t+1),e))return!1;return!0}const X=640,He=T({container:{display:"inline-block",[`@media (max-width: ${X}px)`]:{width:"100%"}},panel:{margin:0,padding:0,listStyleType:"none",width:"100%"},shipList:{display:"grid",gridTemplateRows:"repeat(6, 1fr)",[`@media (max-width: ${X}px)`]:{gridTemplateRows:"repeat(2, 1fr)",gridTemplateColumns:"repeat(3, 1fr)"}},ship:{border:"2px solid black",background:"transparent",color:"#ccc",cursor:"pointer",textAlign:"left",boxSizing:"border-box",margin:{bottom:5},padding:{left:10,right:10,top:5,bottom:5},"@media (max-width: 560px)":{padding:{left:4,right:4,top:2,bottom:2}},"& div":{fontSize:"1.5rem","@media (max-width: 560px)":{fontSize:"1.1rem"}},"& span":{fontSize:"1rem",display:"inline-block","@media (max-width: 560px)":{fontSize:"0.8rem"}}},selectedShip:{backgroundColor:"#0050d4"},placedShip:{borderColor:"#ccc"},actionContainer:{display:"flex",justifyContent:"space-between"},actionButton:{border:"1px solid black",color:"#ccc",background:"#0050d4",fontSize:"1.5rem",cursor:"pointer","&:first-of-type":{marginRight:20},"&:disabled":{cursor:"default",background:"#999"},[`@media (max-width: ${X}px)`]:{alignSelf:"stretch",fontSize:"1rem"}}});function Ie(i){const e=He();return x("div",{className:e.container,children:[l("div",{className:e.shipList,children:i.ships.map(t=>x("button",{onClick:()=>i.onSelected(t.id),className:`${e.ship} ${t.id===i.selectedId?e.selectedShip:""} ${i.placedIds.indexOf(t.id)===-1?"":e.placedShip}`,children:[l("div",{children:t.name}),x("span",{children:["Size: ",t.size]})]},t.id))}),x("div",{className:e.actionContainer,children:[l("button",{className:e.actionButton,onClick:i.onRotated,disabled:!i.canRotate,children:"Rotate"}),l("button",{className:e.actionButton,onClick:i.onPlace,disabled:!i.placementValid,children:"Confirm"})]})]})}const Oe=T({wrapper:{display:"grid",gridTemplateColumns:"5fr 1fr",gridTemplateRows:"100%",width:"100%",height:"100%",columnGap:"10px","@media (max-width: 640px)":{gridTemplateColumns:"100%",gridTemplateRows:"5fr 1fr",rowGap:"10px"}}});function Ee(i){const[e,t]=m.exports.useState([]),[n,s]=m.exports.useState(void 0),[r,o]=m.exports.useState(void 0),a=Oe(),h=Object.values(e);(n==null?void 0:n.ship)&&h.push(n.ship);const g=!!(n==null?void 0:n.ship)&&re(n.ship,Object.values(e),i.gameSettings.gridSize),c=h.length===i.gameSettings.ships.length&&U(h,i.gameSettings.gridSize),d=g?"green":"red",u=r?[{x:r.x,y:r.y,style:d}]:[],S=y=>{if(y!==(n==null?void 0:n.id)){const b=I({},e);(n==null?void 0:n.ship)&&(b[n.id]=n.ship),e[y]?(s({id:y,ship:e[y]}),o(e[y]),delete b[y]):(s({id:y,ship:void 0}),o(void 0)),t(b)}},k=()=>{(n==null?void 0:n.ship)&&s({id:n.id,ship:R(I({},n.ship),{facing:(n.ship.facing+1)%6})})},E=()=>{c&&i.onShipsPlaced(h)},L=y=>{if(n){if(n.ship)s({id:n.id,ship:R(I({},n.ship),{x:y.x,y:y.y})});else{const b=i.gameSettings.ships.find(D=>D.id===n.id);b&&s({id:n.id,ship:{x:y.x,y:y.y,size:b.size,facing:P.positiveX,hits:0,name:b.name,definitionId:b.id}})}o(y)}},G=()=>(n==null?void 0:n.id)?"orange":void 0;return x("div",{className:a.wrapper,children:[l(j,{gridSize:i.gameSettings.gridSize,ships:h,onSelectTile:L,highlightTiles:u,mouseHighlightStyle:G}),l(Ie,{ships:i.gameSettings.ships,placedIds:Object.keys(e).map(Number),selectedId:n==null?void 0:n.id,placementValid:c,canRotate:!!n,onSelected:S,onRotated:k,onPlace:E})]})}const ee={fontSize:"1.6rem",border:"2px solid black",padding:{top:4,bottom:4,left:10,right:10},cursor:"pointer"},Re=T({background:{position:"fixed",width:"100%",height:"100%",background:"rgba(50, 50, 50, 0.6)",zIndex:99},dialog:{border:"3px solid #ccc",display:"inline-block",background:"#333",color:"white",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:20,fontSize:"1.5rem",fontFamily:"sans-serif"},buttonContainer:{display:"flex",justifyContent:"space-between"},okButton:R(I({},ee),{"&:hover":{backgroundColor:"white"}}),cancelButton:R(I({},ee),{color:"#ccc",backgroundColor:"#333","&:hover":{backgroundColor:"#555"}})});function Le(i){const e=Re();return l("div",{className:e.background,children:x("div",{className:e.dialog,children:[l("p",{children:i.text}),x("div",{className:e.buttonContainer,children:[l("button",{className:e.okButton,onClick:i.onOk,children:"OK"}),l("button",{className:e.cancelButton,onClick:i.onCancel,children:"Cancel"})]})]})})}const De=T({wrapper:{display:"grid",gridTemplateRows:"100%",gridTemplateColumns:"4fr 4fr 1fr",width:"100%",height:"100%",gridTemplateAreas:'"friend enemy panel"',"@media (max-width: 640px)":{gridTemplateColumns:"8fr 1fr",gridTemplateRows:"4fr 3fr",gridTemplateAreas:'"enemy enemy" "friend panel"'}},menuButton:{position:"absolute",left:10,top:10,zIndex:10,border:"2px solid white",background:"#333",color:"#ccc",fontSize:"1rem"},statusPanel:{position:"relative",padding:{top:10,left:10,right:10,bottom:60},boxSizing:"border-box",minHeight:90,width:"100%",maxWidth:200,gridArea:"panel","@media (max-width: 640px)":{padding:0},display:"grid",gridTemplateColumns:"100%",gridTemplateRows:"repeat(7, 1fr)"},info:{fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"2rem",margin:0,"@media (max-width: 640px)":{fontSize:"1rem"}},enemyShipHeader:{fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"1.6rem",margin:{top:10,bottom:0},"@media (max-width: 640px)":{fontSize:"0.8rem"}},enemyShips:{display:"grid",gridTemplateColumns:"100%",gridTemplateRows:"repeat(6, 1fr)","@media (max-width: 640px)":{gridTemplateColumns:"1fr 1fr",gridTemplateRows:"repeat(3, 1fr)"}},enemyShip:{border:"2px solid black",color:"#ccc",fontFamily:"sans-serif",fontSize:"1.2rem",position:"relative",padding:4,margin:{top:5},"@media (max-width: 640px)":{fontSize:"0.6rem",padding:2}},enemyShipSunk:{border:"2px solid red","&:after":{width:"100%",height:"100%",display:"inline-block",position:"absolute",top:0,left:0,content:'""',background:"linear-gradient(10deg, transparent 47%, red 47%, red 53%, transparent 53%), linear-gradient(170deg, transparent 47%, red 47%, red 53%, transparent 53%)"}},fire:{border:"2px solid #ccc",cursor:"pointer",color:"white",fontSize:"1.5rem",textShadow:"1px 1px 0 black",background:"radial-gradient(#ff8000, #ff0000)",textTransform:"uppercase","&:hover":{background:"radial-gradient(#ffa447, #ff4747)"},"&:disabled":{color:"#aaa",background:"#777",cursor:"default"}}});function $e(i){const[e,t]=m.exports.useState(void 0),[n,s]=m.exports.useState(0),[r,o]=m.exports.useState(void 0),[a,h]=m.exports.useState(!1),g=De();m.exports.useEffect(()=>{const f=w=>{var J;t(R(I({},w),{ownMarkers:w.ownMarkers.slice(0),opponentMarkers:w.opponentMarkers.slice(0),ownShips:w.ownShips.slice(0),isOwnTurn:w.isOwnTurn,sunkEnemies:w.sunkEnemies.slice(0)}));let W=0;w.gameWon||w.gameLost?W=2:((J=w.ownShips)==null?void 0:J.length)&&(W=1),s(W)};return i.gameInterface.onStateChange(f),()=>{i.gameInterface.offStateChange(f)}},[i.gameInterface,e]);const c=f=>{i.gameInterface.setShips(f)},d=f=>!(e==null?void 0:e.ownMarkers.some(w=>H(f,w))),u=(e==null?void 0:e.isOwnTurn)&&n===1,S=f=>{u&&d(f)&&o(f)},k=f=>u&&d(f)?"orange":void 0,E=()=>{r&&d(r)&&(i.gameInterface.fireShot(r),o(void 0))},L=()=>{h(!0)},G=()=>{h(!1)},y=e==null?void 0:e.opponentMarkers[(e==null?void 0:e.opponentMarkers.length)-1];let b;n===1?b=(e==null?void 0:e.isOwnTurn)?"Take your shot":"Enemy's turn":n===2&&(b=`You have ${(e==null?void 0:e.gameWon)?"Won":"Lost"}`);let D;(e==null?void 0:e.gameWon)?D=e.ownMarkers.filter(f=>f.type===N.Hit).map(f=>({x:f.x,y:f.y,style:"red"})):r&&(D=[{x:r.x,y:r.y,style:"red"}]);let B;return(e==null?void 0:e.gameWon)?B="rgba(0, 255, 0, 0.3)":(e==null?void 0:e.gameLost)&&(B="rgba(255, 0, 0, 0.3)"),x(ne,{children:[a&&l(Le,{text:"Are you sure you want to end the game?",onOk:i.onExit,onCancel:G}),l("button",{className:g.menuButton,onClick:L,children:"Menu"}),n===0?l(Ee,{gameSettings:i.gameSettings,onShipsPlaced:c}):x("div",{className:g.wrapper,children:[l(j,{gridSize:i.gameSettings.gridSize,ships:e==null?void 0:e.ownShips,markers:e==null?void 0:e.opponentMarkers,highlightTiles:y?[{x:y.x,y:y.y,style:"orange"}]:void 0,gridArea:"friend",overlayStyle:B}),l(j,{gridSize:i.gameSettings.gridSize,ships:e==null?void 0:e.opponentShips,markers:e==null?void 0:e.ownMarkers,onSelectTile:S,highlightTiles:D,mouseHighlightStyle:k,gridArea:"enemy",overlayStyle:B}),x("div",{className:g.statusPanel,children:[b&&l("p",{className:g.info,children:b}),l("p",{className:g.enemyShipHeader,children:"Enemy Ships"}),x("div",{className:g.enemyShips,children:[i.gameSettings.ships.map(f=>x("div",{className:`${g.enemyShip} ${(e==null?void 0:e.sunkEnemies.indexOf(f.id))!==-1?g.enemyShipSunk:""}`,children:[f.name," (",f.size,")"]},f.id)),n===1&&l("button",{className:g.fire,onClick:E,disabled:!r||!(e==null?void 0:e.isOwnTurn),children:"Fire"})]})]})]})]})}class Be{constructor(e,t){M(this,"players");M(this,"activePlayerId");this.gameSettings=e,this.subscriber=t,this.players=[{ships:[],markers:[]},{ships:[],markers:[]}],this.activePlayerId=0}getLocalState(e){const t=+!e,n=this.playerLost(t),s=this.playerLost(e),r=s||n;return{ownShips:this.players[e].ships,ownMarkers:this.players[e].markers,opponentShips:r?this.players[t].ships:void 0,opponentMarkers:this.players[t].markers,isOwnTurn:e===this.activePlayerId&&!!this.players[e].ships.length,sunkEnemies:this.players[t].ships.filter(o=>o.hits===o.size).map(o=>o.definitionId),gameWon:n,gameLost:s}}playerLost(e){return this.players[e].ships.every(t=>t.hits===t.size)}validateShipPlacement(e){if(!U(e,this.gameSettings.gridSize))return[];const t=this.gameSettings.ships.slice(0),n=[];for(const s of e){const r=t.findIndex(o=>o.name===s.name&&o.size===s.size);if(r===-1)return[];n.push({x:s.x,y:s.y,size:s.size,facing:s.facing,hits:0,name:s.name,definitionId:s.definitionId}),t.splice(r,1)}return t.length?[]:n}setShips(e,t){const n=this.validateShipPlacement(t);n.length&&(this.players[e].ships=n),this.broadcastState()}fireShot(e,t){const n=+!e;if(this.activePlayerId===e&&v(t,this.gameSettings.gridSize)&&!this.players[e].markers.some(r=>H(r,t))&&!this.playerLost(e)&&!this.playerLost(n)){let r=!1;for(const o of this.players[n].ships)for(const a of Z(o))H(a,t)&&(r=!0,o.hits++);this.players[e].markers.push({x:t.x,y:t.y,type:r?N.Hit:N.Miss}),this.activePlayerId=n}this.broadcastState()}broadcastState(){for(let e=0;e<this.players.length;e++)this.subscriber(e,this.getLocalState(e))}}function $(i,e){return Math.floor(Math.random()*(e-i+1))+i}function Ae(i){const e=Object.keys(i).map(s=>Number.parseInt(s)).filter(s=>!Number.isNaN(s)),t=Math.floor(Math.random()*e.length);return e[t]}class Fe{constructor(e){M(this,"ownShots",[]);M(this,"priorityHits",[]);M(this,"trackedHits",[]);M(this,"sunkShips",[]);this.gameSettings=e}generateShips(){const e=[],t=-this.gameSettings.gridSize,n=-this.gameSettings.gridSize,s=this.gameSettings.gridSize,r=this.gameSettings.gridSize;for(const o of this.gameSettings.ships){let a;do a={size:o.size,name:o.name,x:$(t,s),y:$(n,r),facing:Ae(P),hits:0,definitionId:o.id};while(!U([...e,a],this.gameSettings.gridSize));e.push(a)}return e}updateState(e){var n,s;if(!((n=e.ownMarkers)==null?void 0:n.length))return;const t=e.ownMarkers[e.ownMarkers.length-1];if(this.ownShots[t.x]=this.ownShots[t.x]||[],this.ownShots[t.x][t.y]===void 0&&(this.ownShots[t.x][t.y]=t.type,t.type===N.Hit)){if(e.sunkEnemies.length===this.sunkShips.length)this.priorityHits.push(t),this.trackedHits.push(t);else for(const r of e.sunkEnemies)if(this.sunkShips.indexOf(r)===-1){this.sunkShips.push(r);const o=(s=this.gameSettings.ships.find(a=>a.id===r))==null?void 0:s.size;if(o){let a=!1;for(let h=0;h<6;h++)if(!a){const g=O(h);let c=t;const d=[c];for(let u=0;u<o;u++)c=p(c,g),this.trackedHits.find(k=>H(k,c))&&d.push(c);if(d.length===o){a=!0;for(const u of d){let S=this.trackedHits.findIndex(k=>H(k,u));S!==-1&&this.trackedHits.splice(S,1),S=this.priorityHits.findIndex(k=>H(k,u)),S!==-1&&this.priorityHits.splice(S,1)}}}}}}}getShot(){for(;this.priorityHits.length;){const s=this.priorityHits[0],r=[P.negativeX,P.negativeY,P.negativeZ,P.positiveX,P.positiveY,P.positiveZ];for(;r.length;){const a=r.splice($(0,r.length-1),1)[0];let h=O(a);const g=p(s,h);let c=s;if(this.trackedHits.find(d=>H(d,g))){for(;this.getOwnShot(c)===N.Hit&&v(c,this.gameSettings.gridSize);)c=p(c,h);if(this.getOwnShot(c)===void 0&&v(c,this.gameSettings.gridSize))return c;for(c=s,h=O((a+3)%6);this.getOwnShot(c)===N.Hit&&v(c,this.gameSettings.gridSize);)c=p(c,h);if(this.getOwnShot(c)===void 0&&v(c,this.gameSettings.gridSize))return c}}const o=[];for(let a=0;a<6;a++){const h=O(a),g=p(s,h);this.getOwnShot(g)===void 0&&v(g,this.gameSettings.gridSize)&&o.push(g)}if(o.length)return o[$(0,o.length-1)];this.priorityHits.splice(0,1)}const e=this.gameSettings.ships.filter(s=>!this.sunkShips.some(r=>s.id===r)),t=Math.min(...e.map(s=>s.size)),n=[];for(let s=-this.gameSettings.gridSize;s<=this.gameSettings.gridSize;s++)for(let r=-this.gameSettings.gridSize;r<=this.gameSettings.gridSize;r++){const o={x:s,y:r};if(v(o,this.gameSettings.gridSize)&&this.getOwnShot(o)===void 0)for(let a=0;a<3;a++){const h=O(a);let g=!0;const c=[o];let d=o;for(let u=1;u<t;u++){d=p(d,h);const S=this.getOwnShot(d);!v(d,this.gameSettings.gridSize)||S===N.Miss?g=!1:S===void 0&&c.push(d)}g&&n.push(...c)}}return n[$(0,n.length-1)]}getOwnShot(e){return this.ownShots[e.x]&&this.ownShots[e.x][e.y]}}const Y=0,ie=1;class Ge{constructor(e){M(this,"stateSubscriptions");M(this,"gameManager");M(this,"aiPlayer");this.gameSettings=e,this.stateSubscriptions=[],this.gameManager=new Be(e,(t,n)=>this.sendState(t,n)),this.aiPlayer=new Fe(e)}onStateChange(e){this.stateSubscriptions.push(e)}offStateChange(e){const t=this.stateSubscriptions.indexOf(e);t>=0&&this.stateSubscriptions.splice(t,1)}setShips(e){this.gameManager.setShips(Y,e),this.gameManager.setShips(ie,this.aiPlayer.generateShips())}fireShot(e){this.gameManager.fireShot(Y,e)}sendState(e,t){e===Y?this.stateSubscriptions.forEach(n=>n(t)):(this.aiPlayer.updateState(t),t.isOwnTurn&&!t.gameLost&&!t.gameWon&&setTimeout(()=>{this.takeEnemyShot()},1e3))}takeEnemyShot(){this.gameManager.fireShot(ie,this.aiPlayer.getShot())}}const te={gridSize:7,ships:[{id:1,size:2,name:"Patrol Boat"},{id:2,size:3,name:"Destroyer"},{id:3,size:3,name:"Submarine"},{id:4,size:4,name:"Battleship"},{id:5,size:5,name:"Aircraft Carrier"}]},We=T({container:{backgroundColor:"#022866",width:"100%",height:"100%",overflow:"auto"}});function Ve(){const[i,e]=m.exports.useState(null),t=We(),n=()=>{e(new Ge(te))},s=()=>{e(null)};return l("div",{className:t.container,children:i?l($e,{gameInterface:i,gameSettings:te,onExit:s}):l(fe,{onNewGame:n})})}he.render(l(ge.StrictMode,{children:l(Ve,{})}),document.getElementById("root"));
