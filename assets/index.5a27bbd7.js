var be=Object.defineProperty,ve=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var Z=(t,e,i)=>e in t?be(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,M=(t,e)=>{for(var i in e||(e={}))ze.call(e,i)&&Z(t,i,e[i]);if(oe)for(var i of oe(e))Ce.call(e,i)&&Z(t,i,e[i]);return t},O=(t,e)=>ve(t,we(e));var w=(t,e,i)=>(Z(t,typeof e!="symbol"?e+"":e,i),i);import{c as v,j as p,R as le,a as d,r as f,F as D,l as Te,b as Me,d as Pe}from"./vendor.dc3d6da2.js";const Ne=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}};Ne();var H=(t=>(t[t.positiveX=0]="positiveX",t[t.positiveY=1]="positiveY",t[t.positiveZ=2]="positiveZ",t[t.negativeX=3]="negativeX",t[t.negativeY=4]="negativeY",t[t.negativeZ=5]="negativeZ",t))(H||{});const Ie={[0]:{x:1,y:0},[1]:{x:0,y:1},[2]:{x:-1,y:1},[3]:{x:-1,y:0},[4]:{x:0,y:-1},[5]:{x:1,y:-1}};function L(t){return Ie[t]}function b(...t){const e={x:0,y:0};for(const i of t)e.x+=i.x,e.y+=i.y;return e}function C(t,e){return{x:t.x*e,y:t.y*e}}function P(t,e){return t.x===e.x&&t.y===e.y}function J(t,e){t.moveTo(e.x,e.y)}function ee(t,e){t.lineTo(e.x,e.y)}const te=Math.sqrt(3),N=20;function j(t){return{x:1.5*t.x*N,y:(t.y+.5*t.x)*N*te}}function he(t){const e=j(t);return[...Array(6).keys()].map(i=>{const n=Math.PI/3*i;return{x:e.x+N*Math.cos(n),y:e.y+N*Math.sin(n)}})}function Oe(t){return{x:t*3*N,y:t*2*N*te}}function He(t){const e=-t.x-t.y;let i=Math.round(t.x),n=Math.round(t.y);const s=Math.round(e),o=Math.abs(i-t.x),r=Math.abs(n-t.y),a=Math.abs(s-e);return o>r&&o>a?i=-n-s:r>a&&(n=-i-s),{x:i,y:n}}function Be(t){return He({x:t.x*2/3/N,y:(t.x*-1/3+t.y*te/3)/N})}function z(t,e){const i=-t.x-t.y;return t.x>-e&&t.x<e&&t.y>-e&&t.y<e&&i>-e&&i<e}function Re(t){const e=[];for(let i=-t+1;i<t;i++)for(let n=-t+1;n<t;n++)z({x:i,y:n},t)&&e.push({x:i,y:n});return e}function K(t){const e=L(t.facing);let i={x:t.x,y:t.y};const n=[{x:t.x,y:t.y}];for(let s=1;s<t.size;s++)i=b(i,e),n.push(i);return n}function de(t,e,i){const n=K(t),s=e.map(o=>K(o)).flat();for(const o of n){if(!z(o,i))return!1;for(const r of s)if(P(o,r))return!1}return!0}function ie(t,e){for(let i=0;i<t.length;i++)if(!de(t[i],t.slice(i+1),e))return!1;return!0}var B=(t=>(t[t.Hit=0]="Hit",t[t.Miss=1]="Miss",t))(B||{});function ue(t){return t.filter(e=>e.hits===e.size)}function ne(t,e){return t.shotPerShip?e.ownShips.length-ue(e.ownShips).length:t.shots}class Ee{constructor(e,i){w(this,"players");w(this,"activePlayerId");this.gameSettings=e,this.subscriber=i,this.players=[{ships:[],markers:[],active:!0},{ships:[],markers:[],active:!0}],this.activePlayerId=0}getLocalState(e){const i=+!e,n=this.playerLost(i),s=this.playerLost(e),o=s||n;return{ownShips:this.players[e].ships,ownMarkers:this.players[e].markers,opponentShips:o?this.players[i].ships:void 0,opponentMarkers:this.players[i].markers,isOwnTurn:e===this.activePlayerId&&!!this.players[e].ships.length,sunkEnemies:ue(this.players[i].ships).map(r=>r.definitionId),gameWon:n,gameLost:s,opponentShipsPlaced:!!this.players[i].ships.length,opponentLeft:!this.players[i].active}}playerLost(e){const i=this.players[e];return!i.active||!!i.ships.length&&i.ships.every(n=>n.hits===n.size)}validateShipPlacement(e){const i=this.gameSettings.ships.slice(0),n=[];for(const s of e){const o=i.findIndex(a=>a.id===s.definitionId);if(o===-1)return[];const r=i[o];n.push({x:s.x,y:s.y,size:r.size,facing:s.facing,hits:0,name:r.name,definitionId:s.definitionId}),i.splice(o,1)}return i.length?[]:ie(n,this.gameSettings.gridSize)?n:[]}setShips(e,i){if(!this.players[e])return;const n=this.validateShipPlacement(i);n.length?(this.players[e].ships=n,this.allShipsPlaced()?this.broadcastState():this.sendState(e)):this.sendState(e)}fireShots(e,i){const n=this.players[e],s=this.getLocalState(e),o=+!e;if(this.activePlayerId===e&&!this.playerLost(e)&&!this.playerLost(o)&&this.allShipsPlaced()&&i.length===ne(this.gameSettings,s)&&i.every(a=>!!a&&z(a,this.gameSettings.gridSize)&&!n.markers.some(l=>P(l,a))&&!i.some(l=>l!==a&&P(a,l)))){let a=!1;for(const l of i){let h=!1;for(const g of this.players[o].ships)for(const u of K(g))P(u,l)&&(h=!0,g.hits++);n.markers.push({x:l.x,y:l.y,type:h?B.Hit:B.Miss}),a=a||h}(!this.gameSettings.streak||!a)&&(this.activePlayerId=o),this.broadcastState()}else this.sendState(e)}leaveGame(e){const i=+!e;!this.playerLost(e)&&!this.playerLost(i)&&(this.players[e].active=!1,this.broadcastState())}sendState(e){this.subscriber(e,this.getLocalState(e))}broadcastState(){for(let e=0;e<this.players.length;e++)this.sendState(e)}allShipsPlaced(){return this.players.every(e=>e.ships.length)}}function G(t,e){return Math.floor(Math.random()*(e-t+1))+t}function Le(t){const e=Object.keys(t).map(s=>Number.parseInt(s)).filter(s=>!Number.isNaN(s)),i=Math.floor(Math.random()*e.length);return e[i]}class De{constructor(e){w(this,"ownShots",[]);w(this,"ownShotCount",0);w(this,"priorityHits",[]);w(this,"trackedHits",[]);w(this,"sunkShips",[]);this.gameSettings=e}generateShips(){const e=[],i=-this.gameSettings.gridSize,n=-this.gameSettings.gridSize,s=this.gameSettings.gridSize,o=this.gameSettings.gridSize;for(const r of this.gameSettings.ships){let a;do a={size:r.size,name:r.name,x:G(i,s),y:G(n,o),facing:Le(H),hits:0,definitionId:r.id};while(!ie([...e,a],this.gameSettings.gridSize));e.push(a)}return e}updateState(e){var i,n;if(!!((i=e.ownMarkers)==null?void 0:i.length))for(;e.ownMarkers.length>this.ownShotCount;){const s=e.ownMarkers[this.ownShotCount];if(this.ownShots[s.x]=this.ownShots[s.x]||[],this.ownShots[s.x][s.y]===void 0&&(this.ownShots[s.x][s.y]=s.type,s.type===B.Hit)){if(e.sunkEnemies.length===this.sunkShips.length)this.priorityHits.push(s),this.trackedHits.push(s);else for(const o of e.sunkEnemies)if(this.sunkShips.indexOf(o)===-1){this.sunkShips.push(o);const r=(n=this.gameSettings.ships.find(a=>a.id===o))==null?void 0:n.size;if(r){let a=!1;for(let l=0;l<6;l++)if(!a){const h=L(l);let g=s;const u=[g];for(let c=0;c<r;c++)g=b(g,h),this.trackedHits.find(y=>P(y,g))&&u.push(g);if(u.length===r){a=!0;for(const c of u){let m=this.trackedHits.findIndex(y=>P(y,c));m!==-1&&this.trackedHits.splice(m,1),m=this.priorityHits.findIndex(y=>P(y,c)),m!==-1&&this.priorityHits.splice(m,1)}}}}}}this.ownShotCount++}}getShots(e){const i=[];for(;this.priorityHits.length;){const r=this.priorityHits[0],a=[H.negativeX,H.negativeY,H.negativeZ,H.positiveX,H.positiveY,H.positiveZ];for(;a.length;){const h=a.splice(G(0,a.length-1),1)[0];let g=L(h);const u=b(r,g);let c=r;if(this.trackedHits.find(m=>P(m,u))){for(;this.getOwnShot(c)===B.Hit&&z(c,this.gameSettings.gridSize);)c=b(c,g);for(;this.getOwnShot(c)===void 0&&z(c,this.gameSettings.gridSize);)i.push(c),c=b(c,g);for(c=r,g=L((h+3)%6);this.getOwnShot(c)===B.Hit&&z(c,this.gameSettings.gridSize);)c=b(c,g);for(;this.getOwnShot(c)===void 0&&z(c,this.gameSettings.gridSize);)i.push(c),c=b(c,g)}}if(i.length>=e)return i.slice(0,e);const l=[];for(let h=0;h<6;h++){const g=L(h),u=b(r,g);this.getOwnShot(u)===void 0&&z(u,this.gameSettings.gridSize)&&l.push(u)}for(;l.length;)i.push(l.splice(G(0,l.length-1),1)[0]);if(i.length>=e)return i.slice(0,e);this.priorityHits.splice(0,1)}const n=this.gameSettings.ships.filter(r=>!this.sunkShips.some(a=>r.id===a)),s=Math.min(...n.map(r=>r.size)),o=[];for(let r=-this.gameSettings.gridSize;r<=this.gameSettings.gridSize;r++)for(let a=-this.gameSettings.gridSize;a<=this.gameSettings.gridSize;a++){const l={x:r,y:a};if(z(l,this.gameSettings.gridSize)&&this.getOwnShot(l)===void 0)for(let h=0;h<3;h++){const g=L(h);let u=!0;const c=[l];let m=l;for(let y=1;y<s;y++){m=b(m,g);const I=this.getOwnShot(m);!z(m,this.gameSettings.gridSize)||I===B.Miss?u=!1:I===void 0&&c.push(m)}u&&o.push(...c)}}for(;i.length<e;)i.push(o.splice(G(0,o.length-1),1)[0]);return i}getOwnShot(e){return this.ownShots[e.x]&&this.ownShots[e.x][e.y]}}const _=0,re=1;class $e{constructor(e){w(this,"stateSubscriptions");w(this,"gameManager");w(this,"aiPlayer");this.gameSettings=e,this.stateSubscriptions=[],this.gameManager=new Ee(e,(i,n)=>this.sendState(i,n)),this.aiPlayer=new De(e)}onStateChange(e){this.stateSubscriptions.push(e)}offStateChange(e){const i=this.stateSubscriptions.indexOf(e);i>=0&&this.stateSubscriptions.splice(i,1)}setShips(e){this.gameManager.setShips(_,e),this.gameManager.setShips(re,this.aiPlayer.generateShips())}fireShots(e){this.gameManager.fireShots(_,e)}leaveGame(){}getSettings(){return this.gameSettings}sendState(e,i){e===_?this.stateSubscriptions.forEach(n=>n(i)):(this.aiPlayer.updateState(i),i.isOwnTurn&&!i.gameLost&&!i.gameWon&&setTimeout(()=>{this.takeEnemyShot(i)},1e3))}takeEnemyShot(e){this.gameManager.fireShots(re,this.aiPlayer.getShots(ne(this.gameSettings,e)))}}class Fe{constructor(e,i){w(this,"stateSubscriptions");this.socket=e,this.gameSettings=i,this.stateSubscriptions=[],this.socket.on("update-state",n=>{this.stateSubscriptions.forEach(s=>s(n))})}onStateChange(e){this.stateSubscriptions.push(e)}offStateChange(e){const i=this.stateSubscriptions.indexOf(e);i>=0&&this.stateSubscriptions.splice(i,1)}setShips(e){this.socket.emit("set-ships",e)}fireShots(e){this.socket.emit("fire-shots",e)}leaveGame(){this.socket.emit("leave-game")}getSettings(){return this.gameSettings}}const ae={fontSize:"1.6rem",border:"2px solid black",padding:{top:4,bottom:4,left:10,right:10},cursor:"pointer"},Ge=v({buttonContainer:{display:"flex",justifyContent:"space-between"},okButton:O(M({},ae),{"&:hover":{backgroundColor:"white"}}),cancelButton:O(M({},ae),{color:"#ccc",backgroundColor:"#333","&:hover":{backgroundColor:"#555"}})}),Ae={content:{border:"3px solid #ccc",display:"inline-block",background:"#333",color:"white",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:20,fontSize:"1.5rem",fontFamily:"sans-serif",inset:"50% auto auto 50%"},overlay:{zIndex:999}};function ge(t){const e=Ge(),i=()=>{t.onClose(),t.onOk&&t.onOk()};return p(le,{isOpen:!0,onRequestClose:t.onClose,style:Ae,children:[d("p",{children:t.text}),p("div",{className:e.buttonContainer,children:[t.okButton&&d("button",{className:e.okButton,onClick:i,children:"OK"}),t.cancelButton&&d("button",{className:e.cancelButton,onClick:t.onClose,children:"Cancel"})]})]})}const Ve=v({menu:{margin:0,padding:{left:20},listStyleType:"none"},menuButton:{background:"transparent",border:"none",fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"1.5rem",cursor:"pointer","&:hover":{color:"#fff"}},tooltip:{fontSize:"1.5rem",cursor:"pointer",marginLeft:"20px",color:"#cfc",border:"none",background:"transparent"}});function fe(t){const e=Ve(),[i,n]=f.exports.useState(void 0);return p(D,{children:[i&&d(ge,{text:i,okButton:!0,onClose:()=>n(void 0)}),d("ul",{className:e.menu,children:t.items.filter(s=>s.condition===void 0||s.condition).map(s=>p("li",{children:[d("button",{className:e.menuButton,onClick:s.onClick,children:s.text}),s.tooltip&&d("button",{className:e.tooltip,onClick:()=>n(s.tooltip),children:"(?)"})]},s.text))})]})}const W={ships:[{id:1,size:2,name:"Patrol Boat"},{id:2,size:3,name:"Destroyer"},{id:3,size:3,name:"Submarine"},{id:4,size:4,name:"Battleship"},{id:5,size:5,name:"Aircraft Carrier"}],gridSize:7,streak:!1,shots:1,shotPerShip:!1},je={title:"Basic",id:0,description:"Basic rules with no modifications",settings:W},We={title:"Streak",id:1,description:"Fire again after landing a hit",settings:O(M({},W),{streak:!0})},Ye={title:"Barrage",id:2,description:"Fire 4 shots each turn",settings:O(M({},W),{shots:4})},Xe={title:"Salvo",id:3,description:"Fire 1 shot for each surviving ship",settings:O(M({},W),{shotPerShip:!0})},qe={[0]:je,[1]:We,[2]:Ye,[3]:Xe};function Ze(){return Object.values(qe)}function ce(t){const e=Ze().map(i=>({text:i.title,onClick:()=>t.onSelection(i),tooltip:i.description}));return e.push({text:"Back",onClick:t.onCancel}),d(fe,{items:e})}const _e=v({heading:{fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"3rem",margin:0,padding:{top:10,bottom:10,left:20}},statusText:{fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"1.5rem",padding:{left:20}},buttonStyle:{fontSize:"1.2rem",border:"2px solid black",padding:{top:4,bottom:4,left:10,right:10},margin:{left:20},cursor:"pointer",color:"#ccc",backgroundColor:"#333","&:hover":{backgroundColor:"#555"}}});function Qe(t){const e=_e(),[i,n]=f.exports.useState(!1),[s,o]=f.exports.useState(0),r=h=>{var g,u;n(!0),(g=t.socket)==null||g.once("join-game",c=>{t.onNewGame(new Fe(t.socket,c))}),(u=t.socket)==null||u.emit("quick-connect",h)},a=()=>{var h,g;(h=t.socket)==null||h.emit("cancel-quick-connect"),(g=t.socket)==null||g.removeAllListeners("join-game"),n(!1)},l=h=>{t.onNewGame(new $e(h))};return p(D,{children:[d("h1",{className:e.heading,children:"Hexships"}),i&&p(D,{children:[d("p",{className:e.statusText,children:"Searching for opponent..."}),d("button",{className:e.buttonStyle,onClick:a,children:"Cancel"})]}),!i&&p(D,{children:[s===0&&d(fe,{items:[{text:"Versus AI",onClick:()=>o(1)},{text:"Find Opponent",onClick:()=>o(2),condition:t.isConnected}]}),s===1&&d(ce,{onSelection:h=>l(h.settings),onCancel:()=>o(0)}),s===2&&d(ce,{onSelection:h=>r(h.id),onCancel:()=>o(0)})]})]})}function Y(t,e,i){const n=t.current;if(!n)return;const s=n.getContext("2d");!s||(s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,n.width,n.height),s.scale(e,e),i(s))}const Ke=v({"@keyframes boardGradient":{from:{backgroundPosition:"0% 50%"},to:{backgroundPosition:"100% 50%"}},canvas:{animationName:"$boardGradient",animationDuration:"20s",animationIterationCount:"infinite",animationTimingFunction:"ease",animationDirection:"alternate",position:"absolute",zIndex:1,pointerEvents:"none",background:"linear-gradient(80deg, #00545c 0%, #00405c 30%, #00545c 60%, #00405c 90%)",backgroundSize:"400% 400%",border:"5px solid #242f40",boxSizing:"border-box"}});function Ue(t){const e=f.exports.useRef(null),i=Ke();return f.exports.useEffect(()=>{Y(e,t.uiScale,n=>{n.strokeStyle="black",n.beginPath();const s=Re(t.gridSize);for(const o of s){const r=he(o);J(n,b(r[5],C(t.gridDimensions,.5)));for(const a of r)ee(n,b(a,C(t.gridDimensions,.5)))}n.stroke()})},[t.gridSize,e,t.uiScale,t.gridDimensions]),d("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:i.canvas,"data-testid":"field-canvas"})}const Je=v({canvas:{position:"absolute",zIndex:3,pointerEvents:"none",border:"5px solid transparent",boxSizing:"border-box"}});function et(t){const e=f.exports.useRef(null),i=Je();return f.exports.useEffect(()=>{Y(e,t.uiScale,n=>{n.strokeStyle="grey",n.lineWidth=N,n.lineCap="round",n.beginPath();for(const s of t.ships){const o=j(s),r=L(s.facing),a=b(s,C(r,s.size-1)),l=j(a);J(n,b(o,C(t.gridDimensions,.5))),ee(n,b(l,C(t.gridDimensions,.5)))}n.stroke()})},[t.ships,e,t.uiScale,t.gridDimensions]),d("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:i.canvas,"data-testid":"ships-canvas"})}const tt=v({canvas:{position:"absolute",zIndex:4,pointerEvents:"none",border:"5px solid transparent",boxSizing:"border-box"}});function it(t){const e=f.exports.useRef(null),i=tt();return f.exports.useEffect(()=>{Y(e,t.uiScale,n=>{n.strokeStyle="black";for(const s of t.markers){n.fillStyle=s.type===B.Hit?"red":"white",n.beginPath();const o=b(j(s),C(t.gridDimensions,.5));n.arc(o.x,o.y,N*.4,0,Math.PI*2),n.stroke(),n.fill()}})},[t.markers,e,t.uiScale,t.gridDimensions]),d("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:i.canvas,"data-testid":"marker-canvas"})}const nt=v({canvas:{position:"absolute",zIndex:2,border:"5px solid transparent",boxSizing:"border-box"}});function st(t){const e=f.exports.useRef(null),[i,n]=f.exports.useState(null),[s,o]=f.exports.useState(void 0),r=nt();f.exports.useEffect(()=>{Y(e,t.uiScale,u=>{const c=(m,y)=>{const I=he(m);u.fillStyle=y,u.beginPath(),J(u,b(I[5],C(t.gridDimensions,.5)));for(const R of I)ee(u,b(R,C(t.gridDimensions,.5)));u.fill()};if(t.overlayStyle&&(e==null?void 0:e.current)&&(u.fillStyle=t.overlayStyle,u.fillRect(0,0,999999,999999)),i&&s&&c(i,s),t.highlightTiles)for(const m of t.highlightTiles)c(m,m.style)})},[e,t.highlightTiles,i,s,t.uiScale,t.gridDimensions,t.overlayStyle]);const a=u=>{const c=u.target.getBoundingClientRect(),m=b(C({x:u.clientX,y:u.clientY},1/t.uiScale),C(t.gridDimensions,-.5),C(c,-1/t.uiScale));return Be(m)},l=u=>{const c=a(u);z(c,t.gridSize)&&t.onSelectTile&&t.onSelectTile(c)},h=u=>{const c=a(u);n(z(c,t.gridSize)?c:null),o(t.mouseHighlightStyle?t.mouseHighlightStyle(c):void 0)},g=()=>{n(null)};return d("canvas",{ref:e,width:t.gridDimensions.x*t.uiScale,height:t.gridDimensions.y*t.uiScale,className:r.canvas,onClick:l,onMouseMove:h,onMouseLeave:g,"data-testid":"interaction-canvas"})}const ot=v({board:{position:"relative",width:"100%",maxHeight:"100%",aspectRatio:.86,overflow:"hidden","@media (max-width: 640px)":{maxWidth:"100%",height:"100%"},gridArea:t=>t.gridArea}});function U(t){var r,a;const e=f.exports.useRef(null),[i,n]=f.exports.useState(0),s=ot(t);f.exports.useEffect(()=>{const l=()=>{var h,g;n(Math.min((((h=e==null?void 0:e.current)==null?void 0:h.clientWidth)||0)/420,(((g=e==null?void 0:e.current)==null?void 0:g.clientHeight)||0)/500))};return window.addEventListener("resize",l),l(),()=>{window.removeEventListener("resize",l)}},[e]);const o=Oe(t.gridSize);return p("div",{className:s.board,ref:e,children:[d(Ue,{gridSize:t.gridSize,uiScale:i,gridDimensions:o}),(!!((r=t.highlightTiles)==null?void 0:r.length)||t.onSelectTile||t.mouseHighlightStyle)&&d(st,{gridSize:t.gridSize,onSelectTile:t.onSelectTile,highlightTiles:t.highlightTiles,mouseHighlightStyle:t.mouseHighlightStyle,uiScale:i,gridDimensions:o,overlayStyle:t.overlayStyle}),t.ships&&d(et,{ships:t.ships,uiScale:i,gridDimensions:o}),!!((a=t.markers)==null?void 0:a.length)&&d(it,{markers:t.markers,uiScale:i,gridDimensions:o})]})}const Q=640,rt=v({container:{display:"inline-block",[`@media (max-width: ${Q}px)`]:{width:"100%"}},panel:{margin:0,padding:0,listStyleType:"none",width:"100%"},shipList:{display:"grid",gridTemplateRows:"repeat(6, 1fr)",[`@media (max-width: ${Q}px)`]:{gridTemplateRows:"repeat(2, 1fr)",gridTemplateColumns:"repeat(3, 1fr)"}},ship:{border:"2px solid black",background:"transparent",color:"#ccc",cursor:"pointer",textAlign:"left",boxSizing:"border-box",margin:{bottom:5},padding:{left:10,right:10,top:5,bottom:5},"@media (max-width: 560px)":{padding:{left:4,right:4,top:2,bottom:2}},"& div":{fontSize:"1.5rem","@media (max-width: 560px)":{fontSize:"1.1rem"}},"& span":{fontSize:"1rem",display:"inline-block","@media (max-width: 560px)":{fontSize:"0.8rem"}}},selectedShip:{backgroundColor:"#0050d4"},placedShip:{borderColor:"#ccc"},actionContainer:{display:"flex",justifyContent:"space-between"},actionButton:{border:"1px solid black",color:"#ccc",background:"#0050d4",fontSize:"1.5rem",cursor:"pointer","&:first-of-type":{marginRight:20},"&:disabled":{cursor:"default",background:"#999"},[`@media (max-width: ${Q}px)`]:{alignSelf:"stretch",fontSize:"1rem"}}});function at(t){const e=rt();return p("div",{className:e.container,children:[d("div",{className:e.shipList,children:t.ships.map(i=>p("button",{onClick:()=>t.onSelected(i.id),className:`${e.ship} ${i.id===t.selectedId?e.selectedShip:""} ${t.placedIds.indexOf(i.id)===-1?"":e.placedShip}`,children:[d("div",{children:i.name}),p("span",{children:["Size: ",i.size]})]},i.id))}),p("div",{className:e.actionContainer,children:[d("button",{className:e.actionButton,onClick:t.onRotated,disabled:!t.canRotate,children:"Rotate"}),d("button",{className:e.actionButton,onClick:t.onPlace,disabled:!t.placementValid,children:"Confirm"})]})]})}const ct=v({wrapper:{display:"grid",gridTemplateColumns:"5fr 1fr",gridTemplateRows:"100%",width:"100%",height:"100%",columnGap:"10px","@media (max-width: 640px)":{gridTemplateColumns:"100%",gridTemplateRows:"5fr 1fr",rowGap:"10px"}}});function lt(t){const[e,i]=f.exports.useState([]),[n,s]=f.exports.useState(void 0),[o,r]=f.exports.useState(void 0),a=ct(),l=Object.values(e);(n==null?void 0:n.ship)&&l.push(n.ship);const h=!!(n==null?void 0:n.ship)&&de(n.ship,Object.values(e),t.gameSettings.gridSize),g=l.length===t.gameSettings.ships.length&&ie(l,t.gameSettings.gridSize),u=h?"green":"red",c=o?[{x:o.x,y:o.y,style:u}]:[],m=x=>{if(x!==(n==null?void 0:n.id)){const T=M({},e);(n==null?void 0:n.ship)&&(T[n.id]=n.ship),e[x]?(s({id:x,ship:e[x]}),r(e[x]),delete T[x]):(s({id:x,ship:void 0}),r(void 0)),i(T)}},y=()=>{(n==null?void 0:n.ship)&&s({id:n.id,ship:O(M({},n.ship),{facing:(n.ship.facing+1)%6})})},I=()=>{g&&t.onShipsPlaced(l)},R=x=>{if(n){if(n.ship)s({id:n.id,ship:O(M({},n.ship),{x:x.x,y:x.y})});else{const T=t.gameSettings.ships.find(X=>X.id===n.id);T&&s({id:n.id,ship:{x:x.x,y:x.y,size:T.size,facing:H.positiveX,hits:0,name:T.name,definitionId:T.id}})}r(x)}},$=()=>(n==null?void 0:n.id)?"orange":void 0;return p("div",{className:a.wrapper,children:[d(U,{gridSize:t.gameSettings.gridSize,ships:l,onSelectTile:R,highlightTiles:c,mouseHighlightStyle:$}),d(at,{ships:t.gameSettings.ships,placedIds:Object.keys(e).map(Number),selectedId:n==null?void 0:n.id,placementValid:g,canRotate:!!n,onSelected:m,onRotated:y,onPlace:I})]})}const ht=v({statusPanel:{position:"relative",padding:{top:10,left:10,right:10,bottom:60},boxSizing:"border-box",minHeight:90,width:"100%",maxWidth:200,gridArea:"panel","@media (max-width: 640px)":{padding:0},display:"grid",gridTemplateColumns:"100%",gridTemplateRows:"repeat(7, 1fr)"},info:{fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"2rem",margin:0,"@media (max-width: 640px)":{fontSize:"1rem"}},enemyShipHeader:{fontFamily:["Big Shoulders Stencil Text","sans-serif"],color:"#ccc",fontSize:"1.6rem",margin:{top:10,bottom:0},"@media (max-width: 640px)":{fontSize:"0.8rem"}},enemyShips:{display:"grid",gridTemplateColumns:"100%",gridTemplateRows:"repeat(6, 1fr)","@media (max-width: 640px)":{gridTemplateColumns:"1fr 1fr",gridTemplateRows:"repeat(3, 1fr)"}},enemyShip:{border:"2px solid black",color:"#ccc",fontFamily:"sans-serif",fontSize:"1.2rem",position:"relative",padding:4,margin:{top:5},"@media (max-width: 640px)":{fontSize:"0.6rem",padding:2}},enemyShipSunk:{border:"2px solid red","&:after":{width:"100%",height:"100%",display:"inline-block",position:"absolute",top:0,left:0,content:'""',background:"linear-gradient(10deg, transparent 47%, red 47%, red 53%, transparent 53%), linear-gradient(170deg, transparent 47%, red 47%, red 53%, transparent 53%)"}},fire:{border:"2px solid #ccc",cursor:"pointer",color:"white",fontSize:"1.5rem",textShadow:"1px 1px 0 black",background:"radial-gradient(#ff8000, #ff0000)",textTransform:"uppercase","&:hover":{background:"radial-gradient(#ffa447, #ff4747)"},"&:disabled":{color:"#aaa",background:"#777",cursor:"default"}},shotsRemaining:{color:"#ccc",fontFamily:"sans-serif",fontSize:"1.2rem","@media (max-width: 640px)":{fontSize:"0.6rem"}}});function dt(t){var i;const e=ht();return p("div",{className:e.statusPanel,children:[t.statusMessage&&d("p",{className:e.info,children:t.statusMessage}),((i=t.ships)==null?void 0:i.length)&&p(D,{children:[d("p",{className:e.enemyShipHeader,children:"Enemy Ships"}),p("div",{className:e.enemyShips,children:[t.ships.map(n=>p("div",{className:`${e.enemyShip} ${t.sunkShipIds&&t.sunkShipIds.indexOf(n.id)!==-1?e.enemyShipSunk:""}`,children:[n.name," (",n.size,")"]},n.id)),t.fireButtonVisible&&p(D,{children:[d("button",{className:e.fire,onClick:t.onFireClick,disabled:!t.fireButtonEnabled,children:"Fire"}),!!t.shotsRemaining&&p("p",{className:e.shotsRemaining,children:[t.shotsRemaining," shot",t.shotsRemaining===1?"":"s"," remaining"]})]})]})]})]})}const ut=v({wrapper:{display:"grid",gridTemplateRows:"100%",gridTemplateColumns:"4fr 4fr 1fr",width:"100%",height:"100%",gridTemplateAreas:'"friend enemy panel"',"@media (max-width: 640px)":{gridTemplateColumns:"8fr 1fr",gridTemplateRows:"4fr 3fr",gridTemplateAreas:'"enemy enemy" "friend panel"'}},menuButton:{position:"absolute",left:10,top:10,zIndex:10,border:"2px solid white",background:"#333",color:"#ccc",fontSize:"1rem"}});function gt(t){const[e,i]=f.exports.useState(void 0),[n,s]=f.exports.useState(0),[o,r]=f.exports.useState([]),[a,l]=f.exports.useState(!1),[h,g]=f.exports.useState([]),[u,c]=f.exports.useState([]),m=ut(),y=t.gameInterface.getSettings();f.exports.useEffect(()=>{const S=k=>{var se;i(O(M({},k),{ownMarkers:k.ownMarkers.slice(0),opponentMarkers:k.opponentMarkers.slice(0),ownShips:k.ownShips.slice(0),isOwnTurn:k.isOwnTurn,sunkEnemies:k.sunkEnemies.slice(0)}));const E=k.opponentMarkers.length-h.length;E>0&&(c(k.opponentMarkers.slice(-E)),g([...k.opponentMarkers]));let V=0;k.gameWon||k.gameLost?V=3:((se=k.ownShips)==null?void 0:se.length)&&(k.opponentShipsPlaced?V=2:V=1),s(V)};return t.gameInterface.onStateChange(S),()=>{t.gameInterface.offStateChange(S)}},[t.gameInterface,e,h.length]);const I=S=>{t.gameInterface.setShips(S)},R=S=>!(e==null?void 0:e.ownMarkers.some(k=>P(S,k))),$=(e==null?void 0:e.isOwnTurn)&&n===2,x=e?ne(y,e):0,T=S=>{if($&&R(S)){const k=o.findIndex(E=>P(E,S));if(k===-1)x===1?r([S]):o.length<x&&r([...o,S]);else{const E=[...o];E.splice(k,1),r(E)}}},X=S=>$&&R(S)?"orange":void 0,me=()=>{o.length===x&&o.every(S=>R(S))&&(t.gameInterface.fireShots(o),r([]))},Se=()=>{l(!0)},pe=()=>{t.gameInterface.leaveGame(),t.onExit()},ye=()=>{l(!1)},xe=u.map(S=>({x:S.x,y:S.y,style:"orange"}));let F;n===2?F=(e==null?void 0:e.isOwnTurn)?"Take your shot":"Enemy's turn":n===3?(e==null?void 0:e.opponentLeft)?F="Your opponent left":F=`You have ${(e==null?void 0:e.gameWon)?"Won":"Lost"}`:n===1&&(F="Enemy placing ships");let q;(e==null?void 0:e.gameWon)?q=e.ownMarkers.filter(S=>S.type===B.Hit).map(S=>({x:S.x,y:S.y,style:"red"})):q=o.map(S=>({x:S.x,y:S.y,style:"red"}));let A;(e==null?void 0:e.gameWon)?A="rgba(0, 255, 0, 0.3)":(e==null?void 0:e.gameLost)&&(A="rgba(255, 0, 0, 0.3)");const ke=$&&(y.shots>1||y.shotPerShip)?x-o.length:void 0;return p(D,{children:[a&&d(ge,{text:"Are you sure you want to end the game?",onOk:pe,onClose:ye,okButton:!0,cancelButton:!0}),d("button",{className:m.menuButton,onClick:Se,children:"Menu"}),n===0?d(lt,{gameSettings:y,onShipsPlaced:I}):p("div",{className:m.wrapper,children:[d(U,{gridSize:y.gridSize,ships:e==null?void 0:e.ownShips,markers:e==null?void 0:e.opponentMarkers,highlightTiles:xe,gridArea:"friend",overlayStyle:A}),d(U,{gridSize:y.gridSize,ships:e==null?void 0:e.opponentShips,markers:e==null?void 0:e.ownMarkers,onSelectTile:T,highlightTiles:q,mouseHighlightStyle:X,gridArea:"enemy",overlayStyle:A}),d(dt,{statusMessage:F,ships:n===1?void 0:y.ships,sunkShipIds:e==null?void 0:e.sunkEnemies,fireButtonVisible:n===2,fireButtonEnabled:!!(o.length===x&&(e==null?void 0:e.isOwnTurn)),shotsRemaining:ke,onFireClick:me})]})]})}const ft=v({container:{backgroundColor:"#022866",width:"100%",height:"100%",overflow:"auto"}});function mt(){const[t,e]=f.exports.useState(null),[i,n]=f.exports.useState(!1),[s,o]=f.exports.useState(void 0),r=ft();f.exports.useEffect(()=>{const h=Te();o(h),h.on("connect",()=>{n(!0)})},[]);const a=h=>{e(h)},l=()=>{e(null)};return d("div",{className:r.container,children:t?d(gt,{gameInterface:t,onExit:l}):d(Qe,{onNewGame:a,socket:s,isConnected:i})})}le.setAppElement("#root");Me.render(d(Pe.StrictMode,{children:d(mt,{})}),document.getElementById("root"));
